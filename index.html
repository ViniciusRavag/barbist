<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>BarberShop Pro</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<style>
body {
font-family: 'Inter', sans-serif;
background-color: #F3F4F6;
-webkit-tap-highlight-color: transparent;
}
.no-scrollbar::-webkit-scrollbar {
display: none;
}
.no-scrollbar {
-ms-overflow-style: none;
scrollbar-width: none;
}
/* Animações e Transições */
.view-section {
display: none;
opacity: 0;
transform: translateY(10px);
transition: opacity 0.3s ease-out, transform 0.3s ease-out;
min-height: 100vh;
}
.view-section.active {
display: block;
opacity: 1;
transform: translateY(0);
}
.modal-overlay {
position: fixed;
inset: 0;
background: rgba(0, 0, 0, 0.5);
backdrop-filter: blur(2px);
z-index: 50;
display: flex;
align-items: flex-end;
justify-content: center;
}
.modal-overlay.hidden {
display: none;
}
#modal-bulk-generate {
z-index: 60;
}
.modal-content {
background: white;
width: 100%;
max-width: 450px;
border-radius: 20px 20px 0 0;
padding: 20px;
box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
max-height: 85vh;
overflow-y: auto;
}
@media(min-width: 640px) {
.modal-overlay {
align-items: center;
}
.modal-content {
border-radius: 20px;
}
}
@keyframes slideUp {
from {
transform: translateY(100%);
}
to {
transform: translateY(0);
}
}
/* Estilos Específicos */
.time-slot {
transition: all 0.2s;
border: 1px solid #E5E7EB;
}
.time-slot.selected {
background-color: #3b82f6;
color: white;
border-color: #3b82f6;
box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
}
.time-slot.booked {
background-color: #F3F4F6;
color: #9CA3AF;
text-decoration: line-through;
pointer-events: none;
border-color: transparent;
}
.nav-tab {
white-space: nowrap;
padding: 12px 16px;
font-size: 0.85rem;
font-weight: 600;
color: #64748B;
border-bottom: 2px solid transparent;
transition: all 0.2s;
}
.nav-tab.active {
color: #1e3a8a;
border-bottom-color: #1e3a8a;
}
.calendar-day {
aspect-ratio: 1;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
border-radius: 12px;
font-size: 0.9rem;
position: relative;
cursor: pointer;
transition: all 0.2s;
flex-shrink: 0;
width: 14%;
}
.calendar-day:hover {
background-color: #F1F5F9;
}
.calendar-day.has-slots {
font-weight: 700;
color: #0F172A;
}
.calendar-day.has-slots::after {
content: '';
width: 4px;
height: 4px;
background: #3b82f6;
border-radius: 50%;
position: absolute;
bottom: 6px;
}
.calendar-day.full {
color: #EF4444;
}
.calendar-day.selected {
background-color: #1e3a8a;
color: white;
box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
}
.calendar-day.selected::after {
background: white;
}
.input-field {
width: 100%;
background: #F8FAFC;
border: 1px solid #E2E8F0;
padding: 12px;
border-radius: 12px;
font-size: 0.9rem;
outline: none;
transition: all 0.2s;
}
.input-field:focus {
border-color: #1e3a8a;
background: white;
box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
}
.fab {
position: fixed;
bottom: 20px;
right: 20px;
width: 56px;
height: 56px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
color: white;
box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
z-index: 40;
transition: transform 0.2s;
background: linear-gradient(135deg, #1e3a8a, #1e40af);
}
.fab:active {
transform: scale(0.95);
}
/* Loader styles */
.loader {
display: inline-block;
width: 24px;
height: 24px;
border: 3px solid #f3f3f3;
border-top: 3px solid #1e3a8a;
border-radius: 50%;
animation: spin 1s linear infinite;
}
@keyframes spin {
0% {
transform: rotate(0deg);
}
100% {
transform: rotate(360deg);
}
}
/* Toast notification */
.toast {
position: fixed;
bottom: 20px;
left: 50%;
transform: translateX(-50%);
background: #1e3a8a;
color: white;
padding: 12px 24px;
border-radius: 12px;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
z-index: 100;
opacity: 0;
transition: opacity 0.3s;
}
.toast.show {
opacity: 1;
}
.toast.error {
background: #ef4444;
}
.admin-panel {
background-color: #f8fafc;
height: 100vh;
overflow-y: auto;
}
.dashboard-card {
transition: transform 0.2s, box-shadow 0.2s;
}
.dashboard-card:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
.stats-number {
font-size: 2.5rem;
line-height: 1;
font-weight: 800;
}
.empty-state {
text-align: center;
padding: 40px 20px;
color: #94a3b8;
}
.empty-state i {
font-size: 3rem;
margin-bottom: 16px;
opacity: 0.6;
}
.empty-state p {
font-size: 1.1rem;
margin-top: 8px;
}
.month-view {
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
border-radius: 16px;
overflow: hidden;
}
.booking-card {
transition: all 0.2s;
border-left: 3px solid #1e3a8a;
}
.booking-card:hover {
transform: translateX(4px);
box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}
.service-badge {
display: inline-block;
padding: 2px 8px;
border-radius: 9999px;
font-size: 0.75rem;
font-weight: 600;
}
.service-cut {
background-color: #dbeafe;
color: #1e40af;
}
.service-beard {
background-color: #ffedd5;
color: #c2410c;
}
.service-complete {
background-color: #dcfce7;
color: #166534;
}
.nav-pills .nav-link.active {
background-color: #1e3a8a;
color: white;
}
.nav-pills .nav-link {
color: #4b5563;
}
.barber-avatar {
width: 32px;
height: 32px;
border-radius: 50%;
border: 2px solid #1e3a8a;
display: inline-flex;
align-items: center;
justify-content: center;
font-weight: bold;
color: white;
background: linear-gradient(135deg, #1e3a8a, #3b82f6);
}
</style>
</head>
<body class="text-gray-800 antialiased pb-safe">
<!-- Toast Notification -->
<div id="toast-notification" class="toast">Mensagem de sucesso</div>
<!-- View: Profile (Client View) -->
<div id="view-profile" class="view-section active max-w-md mx-auto bg-white min-h-screen shadow-2xl relative z-10 pb-20">
<div class="h-32 relative">
<div class="absolute inset-0 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1543086961-2e6b5be9b528?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80')"></div>
<div class="absolute inset-0 bg-black/30"></div>
<button onclick="checkAdmin()" class="absolute top-4 right-4 text-white/70 hover:text-white p-2 z-10">
<i class="fa-solid fa-lock"></i>
</button>
<div class="absolute left-4 -bottom-16 z-10">
<div class="w-32 h-32 rounded-full border-4 border-white shadow-lg bg-white overflow-hidden">
<img src="https://images.unsplash.com/photo-1556157258-92af828a725a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80" alt="Barbeiro" class="w-full h-full object-cover">
</div>
</div>
</div>
<div class="px-6 mt-16 relative">
<div class="mt-4 flex justify-between items-start">
<div>
<h1 class="text-2xl font-bold text-gray-900">BarberShop Pro</h1>
<p class="text-sm text-gray-600 font-medium">Barbearia Premium &bull; Desde 2015</p>
</div>
<div class="text-right bg-blue-50 px-3 py-1 rounded-lg">
<p class="text-lg font-bold text-blue-700">A partir de R$ 35</p>
<p class="text-[10px] text-blue-700 font-bold uppercase">Corte Simples</p>
</div>
</div>
<div class="mt-6 space-y-6">
<div>
<h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Nossos Serviços</h3>
<div class="flex flex-wrap gap-2">
<span class="px-3 py-1 bg-gray-100 text-gray-600 text-xs font-semibold rounded-full">Corte Social</span>
<span class="px-3 py-1 bg-gray-100 text-gray-600 text-xs font-semibold rounded-full">Barba</span>
<span class="px-3 py-1 bg-gray-100 text-gray-600 text-xs font-semibold rounded-full">Completo</span>
<span class="px-3 py-1 bg-gray-100 text-gray-600 text-xs font-semibold rounded-full">Sobrancelha</span>
</div>
</div>
<div>
<h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Sobre Nós</h3>
<p class="text-sm text-gray-600 leading-relaxed">
Na BarberShop Pro, oferecemos serviços de alta qualidade com profissionais experientes e equipamentos modernos. Nosso compromisso é com a satisfação do cliente e a excelência em cada atendimento.
</p>
</div>
<div>
<h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Serviços</h3>
<ul class="text-sm text-gray-600 space-y-1">
<li><span class="font-medium text-blue-600">• Corte Social:</span> R$ 35,00 (30 minutos)</li>
<li><span class="font-medium text-blue-600">• Corte Degradê:</span> R$ 45,00 (40 minutos)</li>
<li><span class="font-medium text-blue-600">• Barba Simples:</span> R$ 25,00 (20 minutos)</li>
<li><span class="font-medium text-blue-600">• Barba Completa:</span> R$ 40,00 (35 minutos)</li>
<li><span class="font-medium text-blue-600">• Corte + Barba:</span> R$ 70,00 (60 minutos)</li>
<li><span class="font-medium text-blue-600">• Sobrancelha:</span> R$ 15,00 (10 minutos)</li>
</ul>
</div>
<div>
<h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Horários</h3>
<p class="text-sm text-gray-600">
<i class="fa-solid fa-clock text-blue-500 mr-2"></i>Segunda a Sábado<br>
<i class="fa-solid fa-clock text-blue-500 mr-2"></i>09:00 às 20:00<br>
<i class="fa-solid fa-location-dot text-blue-500 mr-2"></i>Rua das Lâminas, 456 - Centro
</p>
</div>
</div>
<div class="mt-8 pt-6 border-t border-gray-100">
<h3 class="text-sm font-bold text-gray-700 mb-3">Depoimentos</h3>
<div class="space-y-4">
<div class="bg-gray-50 p-4 rounded-xl">
<div class="flex items-center mb-2">
<div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center mr-2">
<span class="text-xs font-bold text-white">J</span>
</div>
<div>
<p class="font-medium text-gray-800">João P.</p>
<div class="flex text-yellow-400">
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
</div>
</div>
</div>
<p class="text-sm text-gray-600 italic">"Melhor barbearia da cidade! Atendimento impecável e profissionais super qualificados."</p>
</div>
<div class="bg-gray-50 p-4 rounded-xl">
<div class="flex items-center mb-2">
<div class="w-8 h-8 rounded-full bg-amber-500 flex items-center justify-center mr-2">
<span class="text-xs font-bold text-white">M</span>
</div>
<div>
<p class="font-medium text-gray-800">Marcos T.</p>
<div class="flex text-yellow-400">
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star-half-stroke"></i>
</div>
</div>
</div>
<p class="text-sm text-gray-600 italic">"Faço meu corte aqui há mais de 2 anos. Sempre saio satisfeito com o resultado."</p>
</div>
</div>
</div>
</div>
<div class="sticky bottom-0 left-0 right-0 p-4 bg-white/80 backdrop-blur-md border-t border-gray-100 z-20">
<button onclick="navigateTo('view-client-calendar')" class="w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-4 rounded-xl shadow-lg transform transition active:scale-[0.98] flex justify-center items-center gap-2">
<i class="fa-regular fa-calendar"></i> Agendar Horário
</button>
</div>
</div>
<!-- View: Client Calendar -->
<div id="view-client-calendar" class="view-section max-w-md mx-auto bg-gray-50 min-h-screen relative">
<div class="bg-white px-4 py-4 shadow-sm sticky top-0 z-20 flex items-center gap-4">
<button onclick="navigateTo('view-profile')" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 text-gray-600">
<i class="fa-solid fa-arrow-left"></i>
</button>
<h2 class="font-bold text-gray-800 text-lg">Escolha um horário</h2>
</div>
<div class="p-4">
<div class="bg-white rounded-2xl p-4 shadow-sm mb-4">
<div class="flex justify-between items-center mb-3">
<h3 class="font-bold text-gray-700" id="client-month-display">Janeiro</h3>
<div class="flex gap-2">
<button onclick="clientChangeDate(-1)" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center">
<i class="fa-solid fa-chevron-left text-xs"></i>
</button>
<button onclick="clientChangeDate(1)" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center">
<i class="fa-solid fa-chevron-right text-xs"></i>
</button>
</div>
</div>
<div id="client-date-scroll" class="flex overflow-x-auto gap-3 pb-2 no-scrollbar snap-x">
</div>
</div>
<div id="client-slots-container">
<div id="client-slots-grid" class="grid grid-cols-2 md:grid-cols-3 gap-3">
</div>
<div id="client-empty-state" class="hidden text-center py-10">
<div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3 text-gray-400">
<i class="fa-regular fa-calendar-xmark text-2xl"></i>
</div>
<p class="text-gray-500 text-sm">Nenhum horário disponível nesta data. Por favor, selecione outra data.</p>
</div>
</div>
<div class="bg-white p-4 rounded-xl shadow-sm mb-4">
<h3 class="font-bold text-gray-700 mb-3">Selecione o Serviço</h3>
<div class="grid grid-cols-2 gap-2">
<button onclick="selectService('Corte Social')" class="service-btn p-2 text-left border rounded-lg hover:bg-blue-50">
<div class="font-medium">Corte Social</div>
<div class="text-xs text-gray-500">R$ 35,00 • 30min</div>
</button>
<button onclick="selectService('Corte Degradê')" class="service-btn p-2 text-left border rounded-lg hover:bg-blue-50">
<div class="font-medium">Corte Degradê</div>
<div class="text-xs text-gray-500">R$ 45,00 • 40min</div>
</button>
<button onclick="selectService('Barba Simples')" class="service-btn p-2 text-left border rounded-lg hover:bg-amber-50">
<div class="font-medium">Barba Simples</div>
<div class="text-xs text-gray-500">R$ 25,00 • 20min</div>
</button>
<button onclick="selectService('Barba Completa')" class="service-btn p-2 text-left border rounded-lg hover:bg-amber-50">
<div class="font-medium">Barba Completa</div>
<div class="text-xs text-gray-500">R$ 40,00 • 35min</div>
</button>
<button onclick="selectService('Corte + Barba')" class="service-btn p-2 text-left border rounded-lg hover:bg-green-50">
<div class="font-medium">Corte + Barba</div>
<div class="text-xs text-gray-500">R$ 70,00 • 60min</div>
</button>
<button onclick="selectService('Sobrancelha')" class="service-btn p-2 text-left border rounded-lg hover:bg-purple-50">
<div class="font-medium">Sobrancelha</div>
<div class="text-xs text-gray-500">R$ 15,00 • 10min</div>
</button>
</div>
</div>
</div>
<div id="client-confirm-bar" class="fixed bottom-0 left-0 right-0 bg-white p-4 border-t border-gray-100 max-w-md mx-auto transform translate-y-full transition-transform duration-300 shadow-[0_-4px_20px_rgba(0,0,0,0.1)]">
<div class="flex justify-between items-center mb-4">
<div>
<p class="text-xs text-gray-500 font-medium uppercase">Horário Selecionado</p>
<p id="client-selected-info" class="text-sm font-bold text-gray-900">--/-- às --:--</p>
</div>
<div class="text-right">
<p class="text-xs text-gray-500 font-medium uppercase">Serviço</p>
<p id="client-selected-service" class="text-sm font-bold text-blue-600">Nenhum serviço selecionado</p>
</div>
</div>
<div class="flex justify-between items-center mb-4">
<p id="client-selected-price" class="text-lg font-bold text-green-600">R$ 0,00</p>
<p class="text-xs text-gray-500">Preço do serviço</p>
</div>
<button onclick="openBookingModal()" id="confirm-booking-btn" disabled class="w-full bg-gray-300 text-white font-bold py-3.5 rounded-xl flex items-center justify-center gap-2 cursor-not-allowed">
<i class="fa-solid fa-check"></i> Selecione um serviço e horário
</button>
</div>
</div>
<!-- View: Admin (separated route) -->
<div id="view-admin" class="view-section admin-panel">
<div class="bg-white px-5 py-4 shadow-sm sticky top-0 z-30 flex justify-between items-center">
<div>
<h2 class="font-bold text-lg text-slate-800">Barber<span class="text-blue-700">Admin</span> <span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full">Admin</span></h2>
</div>
<button onclick="logoutAdmin()" class="text-xs font-semibold text-slate-500 bg-slate-100 px-3 py-1.5 rounded-full hover:bg-slate-200">
<i class="fa-solid fa-arrow-right-from-bracket mr-1"></i> Sair
</button>
</div>
<div class="bg-white border-b border-slate-100 flex overflow-x-auto sticky top-[60px] z-20 hide-scrollbar px-2">
<button onclick="switchTab('dashboard')" class="nav-tab active" data-tab="dashboard">
<i class="fa-solid fa-gauge mr-1"></i> Visão Geral
</button>
<button onclick="switchTab('calendar')" class="nav-tab" data-tab="calendar">
<i class="fa-regular fa-calendar-days mr-1"></i> Agenda
</button>
<button onclick="switchTab('clients')" class="nav-tab" data-tab="clients">
<i class="fa-solid fa-users mr-1"></i> Clientes
</button>
<button onclick="switchTab('financial')" class="nav-tab" data-tab="financial">
<i class="fa-solid fa-chart-line mr-1"></i> Financeiro
</button>
<button onclick="switchTab('barbers')" class="nav-tab" data-tab="barbers">
<i class="fa-solid fa-user-tie mr-1"></i> Barbeiros
</button>
<button onclick="switchTab('settings')" class="nav-tab" data-tab="settings">
<i class="fa-solid fa-gear mr-1"></i> Config
</button>
</div>
<div class="p-4">
<!-- Dashboard Tab -->
<div id="tab-dashboard" class="tab-content block">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
<div class="bg-gradient-to-br from-blue-700 to-blue-600 text-white rounded-2xl p-6 shadow-lg shadow-blue-600/20 relative overflow-hidden dashboard-card">
<div class="absolute -right-6 -top-6 bg-white/20 w-32 h-32 rounded-full blur-2xl"></div>
<div class="relative z-10">
<div class="flex justify-between items-start mb-3">
<h3 class="text-blue-50 font-medium text-xs uppercase tracking-wider">Próximo Atendimento</h3>
<span id="dash-next-badge" class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold">HOJE</span>
</div>
<div id="dash-next-content">
<p id="dash-next-time" class="text-4xl font-bold mb-1">--:--</p>
<p id="dash-next-client" class="text-blue-50 font-medium text-lg truncate">Nenhum agendamento</p>
<p id="dash-next-service" class="text-blue-200 text-sm">Corte Social</p>
<div class="mt-5 grid grid-cols-2 gap-3">
<button onclick="sendQuickMsg()" class="bg-white/90 text-blue-700 font-bold px-4 py-3 rounded-xl flex flex-col items-center justify-center hover:bg-white transition active:scale-95">
<i class="fa-brands fa-whatsapp text-2xl mb-1"></i>
<span class="text-xs font-medium">WhatsApp</span>
</button>
<button onclick="openNextClientDetails()" class="bg-blue-800/50 text-white font-bold px-4 py-3 rounded-xl flex flex-col items-center justify-center hover:bg-blue-800 transition active:scale-95">
<i class="fa-solid fa-user-gear text-2xl mb-1"></i>
<span class="text-xs font-medium">Detalhes</span>
</button>
</div>
</div>
</div>
</div>
<div class="grid grid-cols-2 gap-4">
<div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 dashboard-card">
<div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mb-3">
<i class="fa-solid fa-users text-xl"></i>
</div>
<div class="text-slate-400 text-[10px] font-bold uppercase">Total Clientes</div>
<div class="stats-number text-slate-800" id="dash-total-clients">0</div>
</div>
<div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 dashboard-card">
<div class="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center mb-3">
<i class="fa-solid fa-scissors text-xl"></i>
</div>
<div class="text-slate-400 text-[10px] font-bold uppercase">Atendimentos (Mês)</div>
<div class="stats-number text-slate-800" id="dash-month-count">0</div>
</div>
<div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 dashboard-card">
<div class="w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center mb-3">
<i class="fa-solid fa-money-bill-wave text-xl"></i>
</div>
<div class="text-slate-400 text-[10px] font-bold uppercase">Faturamento</div>
<div class="text-lg font-bold text-slate-800" id="dash-month-revenue">R$ 0,00</div>
</div>
<div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 dashboard-card">
<div class="w-10 h-10 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center mb-3">
<i class="fa-solid fa-clock text-xl"></i>
</div>
<div class="text-slate-400 text-[10px] font-bold uppercase">Disponibilidade</div>
<div class="text-lg font-bold text-slate-800" id="dash-availability">0%</div>
</div>
</div>
</div>
<div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden mb-6">
<div class="p-5 border-b border-slate-100 flex justify-between items-center">
<h3 class="font-bold text-slate-800">Agendamentos dos Próximos 7 Dias</h3>
<button onclick="navigateToTab('calendar')" class="text-blue-600 text-sm font-medium hover:text-blue-700 flex items-center">
Ver agenda completa <i class="fa-solid fa-arrow-right ml-1 text-xs"></i>
</button>
</div>
<div id="upcoming-appointments" class="p-4">
<div class="flex justify-center items-center py-6">
<div class="text-center">
<div class="loader mx-auto mb-3"></div>
<p class="text-slate-500">Carregando agendamentos...</p>
</div>
</div>
</div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
<div class="p-5 border-b border-slate-100">
<h3 class="font-bold text-slate-800">Últimos Clientes</h3>
</div>
<div id="recent-clients" class="p-4 max-h-80 overflow-y-auto">
<div class="flex justify-center items-center py-6">
<div class="text-center">
<div class="loader mx-auto mb-3"></div>
<p class="text-slate-500">Carregando clientes...</p>
</div>
</div>
</div>
</div>
<div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
<div class="p-5 border-b border-slate-100">
<h3 class="font-bold text-slate-800">Serviços Mais Populares</h3>
</div>
<div class="p-6">
<div id="chart-popular-services" class="space-y-4">
<div class="flex items-center">
<span class="w-20 bg-blue-500 h-2 rounded-full mr-3"></span>
<div class="flex-1">
<div class="flex justify-between text-xs">
<span class="font-medium">Corte + Barba</span>
<span>45%</span>
</div>
<div class="h-1 bg-slate-200 rounded-full">
<div class="h-full bg-blue-500 rounded-full" style="width: 45%"></div>
</div>
</div>
</div>
<div class="flex items-center">
<span class="w-20 bg-green-500 h-2 rounded-full mr-3"></span>
<div class="flex-1">
<div class="flex justify-between text-xs">
<span class="font-medium">Corte Social</span>
<span>30%</span>
</div>
<div class="h-1 bg-slate-200 rounded-full">
<div class="h-full bg-green-500 rounded-full" style="width: 30%"></div>
</div>
</div>
</div>
<div class="flex items-center">
<span class="w-20 bg-amber-500 h-2 rounded-full mr-3"></span>
<div class="flex-1">
<div class="flex justify-between text-xs">
<span class="font-medium">Barba Completa</span>
<span>15%</span>
</div>
<div class="h-1 bg-slate-200 rounded-full">
<div class="h-full bg-amber-500 rounded-full" style="width: 15%"></div>
</div>
</div>
</div>
<div class="flex items-center">
<span class="w-20 bg-purple-500 h-2 rounded-full mr-3"></span>
<div class="flex-1">
<div class="flex justify-between text-xs">
<span class="font-medium">Outros Serviços</span>
<span>10%</span>
</div>
<div class="h-1 bg-slate-200 rounded-full">
<div class="h-full bg-purple-500 rounded-full" style="width: 10%"></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Calendar Tab -->
<div id="tab-calendar" class="tab-content hidden">
<div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden month-view">
<div class="p-4 flex justify-between items-center border-b border-slate-100">
<button onclick="changeAdminMonth(-1)" class="w-10 h-10 hover:bg-slate-50 rounded-full flex items-center justify-center text-slate-500">
<i class="fa-solid fa-chevron-left text-xl"></i>
</button>
<h3 id="admin-calendar-month" class="font-bold text-slate-800 text-lg capitalize">Janeiro 2026</h3>
<button onclick="changeAdminMonth(1)" class="w-10 h-10 hover:bg-slate-50 rounded-full flex items-center justify-center text-slate-500">
<i class="fa-solid fa-chevron-right text-xl"></i>
</button>
</div>
<div class="grid grid-cols-7 gap-px bg-slate-100">
<div class="bg-slate-50 py-2 text-center text-[10px] font-bold text-slate-400 uppercase">D</div>
<div class="bg-slate-50 py-2 text-center text-[10px] font-bold text-slate-400 uppercase">S</div>
<div class="bg-slate-50 py-2 text-center text-[10px] font-bold text-slate-400 uppercase">T</div>
<div class="bg-slate-50 py-2 text-center text-[10px] font-bold text-slate-400 uppercase">Q</div>
<div class="bg-slate-50 py-2 text-center text-[10px] font-bold text-slate-400 uppercase">Q</div>
<div class="bg-slate-50 py-2 text-center text-[10px] font-bold text-slate-400 uppercase">S</div>
<div class="bg-slate-50 py-2 text-center text-[10px] font-bold text-slate-400 uppercase">S</div>
</div>
<div id="admin-calendar-grid" class="grid grid-cols-7 gap-px bg-slate-100 p-px min-h-[500px]">
</div>
</div>
<div class="mt-4 flex justify-center gap-4 text-xs text-slate-500">
<div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-600"></span> Com Agendamento</div>
<div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-slate-300"></span> Vazio</div>
<div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-500"></span> Cheio</div>
</div>
<div class="bg-white rounded-2xl shadow-sm border border-slate-100 mt-6 p-5">
<div class="flex items-center justify-between mb-4">
<h3 class="font-bold text-slate-800">Gerenciar Horários</h3>
<button onclick="openDayModal(new Date().toISOString().split('T')[0])" class="text-blue-600 font-medium flex items-center">
<i class="fa-solid fa-plus mr-1"></i> Adicionar Horários Hoje
</button>
</div>
<div class="grid grid-cols-2 md:grid-cols-4 gap-4">
<div class="flex items-center">
<div class="w-4 h-4 rounded-full bg-blue-500 mr-2"></div>
<span class="text-sm">Horários disponíveis</span>
</div>
<div class="flex items-center">
<div class="w-4 h-4 rounded-full bg-amber-500 mr-2"></div>
<span class="text-sm">Horários parcialmente cheios</span>
</div>
<div class="flex items-center">
<div class="w-4 h-4 rounded-full bg-red-500 mr-2"></div>
<span class="text-sm">Horários esgotados</span>
</div>
<div class="flex items-center">
<div class="w-4 h-4 rounded-full bg-gray-300 mr-2"></div>
<span class="text-sm">Sem horários disponíveis</span>
</div>
</div>
</div>
</div>
<!-- Clients Tab -->
<div id="tab-clients" class="tab-content hidden">
<div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden mb-6">
<div class="p-4">
<div class="relative">
<i class="fa-solid fa-search absolute left-3 top-3.5 text-slate-400 text-sm"></i>
<input type="text" id="client-search" onkeyup="renderClients()" placeholder="Buscar por nome, telefone..." class="w-full bg-slate-50 pl-10 pr-4 py-3 rounded-xl shadow-sm border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 text-sm transition">
</div>
</div>
<div class="border-t border-slate-100 p-3 bg-slate-50 flex justify-between items-center">
<div class="text-xs text-slate-500">
<span id="clients-count">0</span> clientes encontrados
</div>
<div class="flex gap-2">
<button onclick="exportClientsToCSV()" class="text-xs bg-white px-3 py-1.5 rounded-lg border border-slate-300 hover:bg-slate-50 flex items-center">
<i class="fa-solid fa-file-csv mr-1"></i> Exportar CSV
</button>
<button onclick="openNewClientModal()" class="text-xs bg-blue-600 text-white px-3 py-1.5 rounded-lg hover:bg-blue-700 flex items-center">
<i class="fa-solid fa-plus mr-1"></i> Novo Cliente
</button>
</div>
</div>
</div>
<div id="clients-list" class="space-y-3">
<div class="flex justify-center items-center py-10">
<div class="text-center">
<div class="loader mx-auto mb-3"></div>
<p class="text-slate-500">Carregando clientes...</p>
</div>
</div>
</div>
<div class="mt-6 flex justify-center">
<button id="load-more-clients" class="px-4 py-2 text-blue-600 font-medium rounded-lg border border-blue-200 bg-blue-50 hover:bg-blue-100 hidden">
Carregar mais clientes
</button>
</div>
</div>
<!-- Financial Tab -->
<div id="tab-financial" class="tab-content hidden">
<div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 text-center mb-6">
<p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Estimativa Mensal</p>
<h2 class="text-4xl font-bold text-slate-800" id="fin-total">R$ 0,00</h2>
<p class="text-xs text-green-600 bg-green-50 inline-block px-3 py-1 rounded-full mt-3 font-medium">
<i class="fa-solid fa-arrow-trend-up mr-1"></i> Baseado em agendamentos confirmados
</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
<div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
<p class="text-xs text-slate-400 font-bold uppercase mb-1">Atendimentos Realizados</p>
<p class="text-2xl font-bold text-slate-800" id="fin-sessions-done">0</p>
<p class="text-xs text-slate-500 mt-1">Este mês</p>
</div>
<div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
<p class="text-xs text-slate-400 font-bold uppercase mb-1">Ticket Médio</p>
<p class="text-2xl font-bold text-slate-800" id="fin-average-per-session">R$ 0,00</p>
<p class="text-xs text-slate-500 mt-1">Valor médio por atendimento</p>
</div>
<div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
<p class="text-xs text-slate-400 font-bold uppercase mb-1">Total em Serviços</p>
<p class="text-2xl font-bold text-slate-800" id="fin-total-services">R$ 0,00</p>
<p class="text-xs text-slate-500 mt-1">Serviços prestados</p>
</div>
</div>
<div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
<div class="p-5 border-b border-slate-100 flex justify-between items-center">
<h3 class="font-bold text-slate-700 text-sm">Histórico de Receita</h3>
<select id="financial-period" onchange="renderFinancial()" class="text-sm border border-slate-200 rounded-lg px-3 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
<option value="month">Este mês</option>
<option value="quarter">Últimos 3 meses</option>
<option value="semester">Últimos 6 meses</option>
<option value="year" selected>Últimos 12 meses</option>
</select>
</div>
<div id="fin-history" class="divide-y divide-slate-100">
<div class="p-4 text-center text-slate-500">
Carregando dados financeiros...
</div>
</div>
</div>
</div>
<!-- Barbers Tab -->
<div id="tab-barbers" class="tab-content hidden">
<div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden mb-6">
<div class="p-4 flex justify-between items-center">
<h3 class="font-bold text-slate-800">Nossos Barbeiros</h3>
<button onclick="openNewBarberModal()" class="text-xs bg-blue-600 text-white px-3 py-1.5 rounded-lg hover:bg-blue-700 flex items-center">
<i class="fa-solid fa-plus mr-1"></i> Novo Barbeiro
</button>
</div>
<div id="barbers-list" class="p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
<div class="flex justify-center items-center py-10 col-span-full">
<div class="text-center">
<div class="loader mx-auto mb-3"></div>
<p class="text-slate-500">Carregando barbeiros...</p>
</div>
</div>
</div>
</div>
<div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
<div class="p-5 border-b border-slate-100">
<h3 class="font-bold text-slate-800">Escala de Trabalho</h3>
<p class="text-sm text-slate-500">Gerencie os horários e dias de trabalho de cada barbeiro</p>
</div>
<div class="p-5">
<div class="space-y-4">
<div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
<div class="flex items-center">
<div class="barber-avatar mr-3">R</div>
<div>
<h4 class="font-bold text-slate-800">Rafael Silva</h4>
<p class="text-sm text-slate-500">Especialista em cortes sociais e barba</p>
</div>
</div>
<div class="flex items-center space-x-2">
<span class="text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full">Ativo</span>
<button class="text-blue-600 hover:text-blue-800">
<i class="fa-solid fa-pen-to-square"></i>
</button>
</div>
</div>
<div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
<div class="flex items-center">
<div class="barber-avatar bg-amber-500 mr-3">M</div>
<div>
<h4 class="font-bold text-slate-800">Marcos Almeida</h4>
<p class="text-sm text-slate-500">Especialista em degarês e penteados</p>
</div>
</div>
<div class="flex items-center space-x-2">
<span class="text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full">Ativo</span>
<button class="text-blue-600 hover:text-blue-800">
<i class="fa-solid fa-pen-to-square"></i>
</button>
</div>
</div>
<div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
<div class="flex items-center">
<div class="barber-avatar bg-green-500 mr-3">P</div>
<div>
<h4 class="font-bold text-slate-800">Pedro Santos</h4>
<p class="text-sm text-slate-500">Especialista em barba e design facial</p>
</div>
</div>
<div class="flex items-center space-x-2">
<span class="text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded-full">Férias</span>
<button class="text-blue-600 hover:text-blue-800">
<i class="fa-solid fa-pen-to-square"></i>
</button>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Settings Tab -->
<div id="tab-settings" class="tab-content hidden">
<div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 space-y-6">
<div>
<h3 class="font-bold text-slate-800 text-sm border-b border-slate-100 pb-2 mb-4">Configurações Gerais</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="block text-xs font-bold text-slate-500 mb-1">Nome da Barbearia</label>
<input type="text" id="setting-barbershop-name" placeholder="BarberShop Pro" class="input-field">
</div>
<div>
<label class="block text-xs font-bold text-slate-500 mb-1">Endereço</label>
<input type="text" id="setting-address" placeholder="Rua das Lâminas, 456 - Centro" class="input-field">
</div>
<div class="md:col-span-2">
<label class="block text-xs font-bold text-slate-500 mb-1">Serviços (separados por vírgula)</label>
<input type="text" id="setting-services" placeholder="Corte Social, Corte Degradê, Barba Simples, Barba Completa, Corte + Barba, Sobrancelha" class="input-field">
</div>
<div class="md:col-span-2">
<label class="block text-xs font-bold text-slate-500 mb-1">Horário Comercial (Dias)</label>
<div class="grid grid-cols-7 gap-2 mt-2">
<label class="flex flex-col items-center">
<input type="checkbox" id="day-sun" class="form-checkbox h-4 w-4 text-blue-600">
<span class="text-[10px] mt-1">Dom</span>
</label>
<label class="flex flex-col items-center">
<input type="checkbox" id="day-mon" class="form-checkbox h-4 w-4 text-blue-600" checked>
<span class="text-[10px] mt-1">Seg</span>
</label>
<label class="flex flex-col items-center">
<input type="checkbox" id="day-tue" class="form-checkbox h-4 w-4 text-blue-600" checked>
<span class="text-[10px] mt-1">Ter</span>
</label>
<label class="flex flex-col items-center">
<input type="checkbox" id="day-wed" class="form-checkbox h-4 w-4 text-blue-600" checked>
<span class="text-[10px] mt-1">Qua</span>
</label>
<label class="flex flex-col items-center">
<input type="checkbox" id="day-thu" class="form-checkbox h-4 w-4 text-blue-600" checked>
<span class="text-[10px] mt-1">Qui</span>
</label>
<label class="flex flex-col items-center">
<input type="checkbox" id="day-fri" class="form-checkbox h-4 w-4 text-blue-600" checked>
<span class="text-[10px] mt-1">Sex</span>
</label>
<label class="flex flex-col items-center">
<input type="checkbox" id="day-sat" class="form-checkbox h-4 w-4 text-blue-600" checked>
<span class="text-[10px] mt-1">Sáb</span>
</label>
</div>
</div>
</div>
</div>
<div>
<h3 class="font-bold text-slate-800 text-sm border-b border-slate-100 pb-2 mb-4">Automação WhatsApp</h3>
<div>
<label class="block text-xs font-bold text-slate-500 mb-1">Mensagem de Confirmação</label>
<textarea id="setting-msg-confirm" rows="3" class="input-field text-xs" placeholder="Olá {nome}, confirmamos seu agendamento para {data} às {hora} para {servico}.">{nome}, confirmamos seu agendamento para {data} às {hora} para {servico}. Valor: R$ {valor}. Estamos localizados na Rua das Lâminas, 456. Chegue 10 minutos antes do horário marcado.</textarea>
<p class="text-[10px] text-slate-400 mt-1">Variáveis disponíveis: {nome}, {data}, {hora}, {servico}, {valor}, {barbeiro}</p>
</div>
<div class="mt-4">
<label class="block text-xs font-bold text-slate-500 mb-1">Mensagem de Lembrete (24h antes)</label>
<textarea id="setting-msg-reminder" rows="3" class="input-field text-xs" placeholder="Olá {nome}, lembrando do seu agendamento amanhã ({data}) às {hora} para {servico}.">{nome}, apenas um lembrete sobre seu agendamento amanhã ({data}) às {hora} para {servico}. Estamos ansiosos para atendê-lo na BarberShop Pro!</textarea>
<p class="text-[10px] text-slate-400 mt-1">Variáveis disponíveis: {nome}, {data}, {hora}, {servico}</p>
</div>
</div>
<button onclick="saveSettings()" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-500/20 hover:bg-blue-700 transition active:scale-95">
<i class="fa-solid fa-save mr-2"></i> Salvar Todas as Configurações
</button>
</div>
<div class="mt-6 bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
<h3 class="font-bold text-slate-800 text-sm border-b border-slate-100 pb-2 mb-4">Backup & Dados</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<button onclick="exportAllData()" class="flex flex-col items-center justify-center p-4 border-2 border-dashed border-slate-300 rounded-xl hover:border-blue-500 hover:bg-blue-50/50 transition">
<i class="fa-solid fa-download text-3xl text-blue-600 mb-2"></i>
<span class="font-medium text-slate-700">Exportar Dados</span>
<span class="text-xs text-slate-500 mt-1">Backup completo de todos os dados</span>
</button>
<button onclick="importData()" class="flex flex-col items-center justify-center p-4 border-2 border-dashed border-slate-300 rounded-xl hover:border-amber-500 hover:bg-amber-50/50 transition">
<i class="fa-solid fa-upload text-3xl text-amber-600 mb-2"></i>
<span class="font-medium text-slate-700">Importar Dados</span>
<span class="text-xs text-slate-500 mt-1">Restaurar backup anterior</span>
</button>
</div>
</div>
<div class="mt-6 text-center">
<button onclick="resetApp()" class="text-red-500 text-sm font-bold hover:underline flex items-center justify-center">
<i class="fa-solid fa-triangle-exclamation mr-1"></i> Resetar Dados do Aplicativo
</button>
</div>
</div>
</div>
</div>
<!-- Modals -->
<div id="modal-message-selection" class="modal-overlay hidden">
<div class="modal-content">
<div class="flex justify-between items-center mb-4">
<h3 class="font-bold text-lg text-gray-900">Enviar Mensagem</h3>
<button onclick="closeModal('modal-message-selection')" class="w-8 h-8 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200 transition">
<i class="fa-solid fa-times"></i>
</button>
</div>
<p class="text-sm text-gray-600 mb-6">Escolha o tipo de mensagem que deseja enviar para o cliente via WhatsApp:</p>
<div class="space-y-3">
<button onclick="sendMessage('confirm')" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 transition flex items-center justify-center">
<i class="fa-solid fa-check-circle mr-2"></i> Confirmação de Agendamento
</button>
<button onclick="sendMessage('reminder')" class="w-full bg-amber-500 text-white font-bold py-3 rounded-xl hover:bg-amber-600 transition flex items-center justify-center">
<i class="fa-solid fa-bell mr-2"></i> Lembrete de Atendimento
</button>
</div>
</div>
</div>
<div id="modal-bulk-generate" class="modal-overlay hidden">
<div class="modal-content">
<div class="flex justify-between items-center mb-4">
<h3 class="font-bold text-lg text-gray-900">Gerar Horários</h3>
<button onclick="closeModal('modal-bulk-generate')" class="w-8 h-8 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200 transition">
<i class="fa-solid fa-times"></i>
</button>
</div>
<div class="bg-blue-50 p-3 rounded-lg mb-4">
<p class="text-sm text-blue-700 flex items-start">
<i class="fa-solid fa-circle-info mt-1 mr-2"></i>
<span id="bulk-generate-message">Você está prestes a gerar horários para este período. Selecione a opção abaixo para aplicar aos próximos dias úteis.</span>
</p>
</div>
<div class="mb-6">
<label class="flex items-start cursor-pointer">
<div class="flex items-center h-5">
<input type="checkbox" id="apply-to-all-days" class="form-checkbox h-4 w-4 text-blue-600 rounded">
</div>
<div class="ml-3 text-sm">
<span class="font-medium text-gray-700">Aplicar para todos os dias úteis</span>
<p class="text-xs text-gray-500 mt-1">Esta ação adicionará horários nos próximos 30 dias úteis, respeitando seu horário comercial configurado.</p>
</div>
</label>
</div>
<button onclick="confirmBulkGenerate()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 transition flex items-center justify-center">
<i class="fa-solid fa-check mr-2"></i> Confirmar Geração
</button>
</div>
</div>
<div id="modal-booking" class="modal-overlay hidden">
<div class="modal-content">
<div class="flex justify-between items-center mb-6">
<h3 class="font-bold text-lg text-gray-900">Finalizar Agendamento</h3>
<button onclick="closeModal('modal-booking')" class="w-8 h-8 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200 transition">
<i class="fa-solid fa-times"></i>
</button>
</div>
<form onsubmit="confirmBooking(event)" class="space-y-4">
<input type="text" id="book-name" placeholder="Seu Nome Completo" required class="input-field">
<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
<input type="tel" id="book-phone" placeholder="Seu WhatsApp (11) 99999-9999" required class="input-field" maxlength="15">
<input type="email" id="book-email" placeholder="Seu E-mail (opcional)" class="input-field">
</div>
<div>
<label class="block text-xs font-bold text-slate-500 mb-1">Serviço Desejado</label>
<select id="book-service" class="input-field" required>
<option value="">Selecione um serviço</option>
<option value="Corte Social">Corte Social - R$ 35,00</option>
<option value="Corte Degradê">Corte Degradê - R$ 45,00</option>
<option value="Barba Simples">Barba Simples - R$ 25,00</option>
<option value="Barba Completa">Barba Completa - R$ 40,00</option>
<option value="Corte + Barba">Corte + Barba - R$ 70,00</option>
<option value="Sobrancelha">Sobrancelha - R$ 15,00</option>
</select>
</div>
<div>
<label class="block text-xs font-bold text-slate-500 mb-1">Como conheceu nossa barbearia?</label>
<select id="book-source" class="input-field">
<option value="indication">Indicação</option>
<option value="google">Google</option>
<option value="instagram">Instagram</option>
<option value="facebook">Facebook</option>
<option value="other">Outro</option>
</select>
</div>
<div class="bg-blue-50 p-3 rounded-xl flex gap-3">
<i class="fa-solid fa-circle-info text-blue-600 mt-0.5"></i>
<p class="text-xs text-blue-800">Ao confirmar, você receberá os detalhes do agendamento via WhatsApp e e-mail (se informado).</p>
</div>
<button type="submit" class="w-full bg-gray-900 text-white font-bold py-4 rounded-xl hover:bg-black transition active:scale-[0.98] flex justify-center items-center gap-2">
<i class="fa-solid fa-check"></i> Confirmar Agendamento
</button>
</form>
</div>
</div>
<div id="modal-day" class="modal-overlay hidden">
<div class="modal-content h-[85vh] flex flex-col">
<div class="flex justify-between items-center mb-4">
<div>
<h3 id="modal-day-title" class="font-bold text-xl text-slate-800">--</h3>
<p id="modal-day-date" class="text-xs text-slate-500 flex items-center">
<i class="fa-regular fa-calendar-days mr-1 text-slate-400"></i>
<span>Gerenciar Dia</span>
</p>
</div>
<button onclick="closeModal('modal-day')" class="w-8 h-8 bg-slate-100 rounded-full text-slate-500 hover:bg-slate-200 transition">
<i class="fa-solid fa-times"></i>
</button>
</div>
<div class="flex border-b border-slate-100 mb-4">
<button onclick="switchDayTab('slots')" id="btn-tab-day-slots" class="flex-1 pb-2 text-sm font-bold text-blue-600 border-b-2 border-blue-600">
<i class="fa-regular fa-clock mr-1"></i> Horários
</button>
<button onclick="switchDayTab('bookings')" id="btn-tab-day-bookings" class="flex-1 pb-2 text-sm font-bold text-slate-400 border-b-2 border-transparent">
<i class="fa-solid fa-calendar-check mr-1"></i> Agendamentos
</button>
</div>
<div id="day-content-slots" class="flex-1 overflow-y-auto">
<div class="bg-slate-50 p-3 rounded-xl mb-4 border border-slate-100">
<p class="text-[10px] font-bold text-slate-400 uppercase mb-2 flex items-center">
<i class="fa-solid fa-bolt mr-1 text-amber-500"></i> Gerador Rápido de Horários
</p>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
<button onclick="bulkGenerate('morning')" class="bg-white border border-slate-200 text-xs py-2.5 rounded-lg hover:border-blue-500 hover:text-blue-600 transition flex items-center justify-center">
<i class="fa-solid fa-sun mr-1"></i> Manhã (09-12h)
</button>
<button onclick="bulkGenerate('afternoon')" class="bg-white border border-slate-200 text-xs py-2.5 rounded-lg hover:border-blue-500 hover:text-blue-600 transition flex items-center justify-center">
<i class="fa-solid fa-cloud-sun mr-1"></i> Tarde (13-18h)
</button>
<button onclick="bulkGenerate('evening')" class="bg-white border border-slate-200 text-xs py-2.5 rounded-lg hover:border-blue-500 hover:text-blue-600 transition flex items-center justify-center">
<i class="fa-solid fa-moon mr-1"></i> Noite (19-20h)
</button>
<button onclick="bulkGenerate('all')" class="bg-white border border-slate-200 text-xs py-2.5 rounded-lg hover:border-blue-500 hover:text-blue-600 transition flex items-center justify-center">
<i class="fa-solid fa-business-time mr-1"></i> Dia Todo
</button>
</div>
</div>
<div class="flex gap-2 mb-4">
<input type="time" id="new-slot-time" class="input-field py-2 flex-1">
<button onclick="addSlot()" class="bg-blue-600 text-white px-4 rounded-xl shadow-lg shadow-blue-500/30 hover:bg-blue-700 transition">
<i class="fa-solid fa-plus"></i>
</button>
</div>
<h4 class="text-sm font-bold text-slate-700 mb-3 flex items-center">
<i class="fa-solid fa-list-check mr-2 text-blue-600"></i> Horários Disponíveis
</h4>
<div id="admin-slots-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
<div class="text-center py-4 text-slate-500">
Nenhum horário cadastrado para este dia
</div>
</div>
</div>
<div id="day-content-bookings" class="hidden flex-1 overflow-y-auto space-y-3">
<div class="text-center py-6 text-slate-500">
Nenhum agendamento para este dia
</div>
</div>
</div>
</div>
<div id="modal-new-client" class="modal-overlay hidden">
<div class="modal-content">
<div class="flex justify-between items-center mb-6">
<h3 class="font-bold text-lg text-gray-900">Novo Cliente</h3>
<button onclick="closeModal('modal-new-client')" class="w-8 h-8 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200 transition">
<i class="fa-solid fa-times"></i>
</button>
</div>
<form onsubmit="saveNewClient(event)" class="space-y-4">
<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
<input type="text" id="client-name" placeholder="Nome Completo*" required class="input-field">
<input type="tel" id="client-phone" placeholder="WhatsApp* (11) 99999-9999" required class="input-field" maxlength="15">
<input type="email" id="client-email" placeholder="E-mail" class="input-field">
<select id="client-preferred-barber" class="input-field">
<option value="">Barbeiro Preferencial (Opcional)</option>
<option value="Rafael">Rafael Silva</option>
<option value="Marcos">Marcos Almeida</option>
<option value="Pedro">Pedro Santos</option>
</select>
</div>
<div>
<label class="block text-xs font-bold text-slate-500 mb-1">Histórico de Serviços</label>
<textarea id="client-service-history" rows="2" class="input-field text-sm" placeholder="Cortes anteriores, preferências, alergias..."></textarea>
</div>
<button type="submit" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl hover:bg-blue-700 transition active:scale-[0.98] flex justify-center items-center gap-2">
<i class="fa-solid fa-user-plus"></i> Cadastrar Cliente
</button>
</form>
</div>
</div>
<div id="modal-new-barber" class="modal-overlay hidden">
<div class="modal-content">
<div class="flex justify-between items-center mb-6">
<h3 class="font-bold text-lg text-gray-900">Novo Barbeiro</h3>
<button onclick="closeModal('modal-new-barber')" class="w-8 h-8 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200 transition">
<i class="fa-solid fa-times"></i>
</button>
</div>
<form onsubmit="saveNewBarber(event)" class="space-y-4">
<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
<input type="text" id="barber-name" placeholder="Nome Completo*" required class="input-field">
<input type="tel" id="barber-phone" placeholder="Telefone (11) 99999-9999" class="input-field" maxlength="15">
<input type="email" id="barber-email" placeholder="E-mail Profissional*" required class="input-field">
<select id="barber-specialty" class="input-field" required>
<option value="">Especialidade Principal</option>
<option value="corte">Cortes</option>
<option value="barba">Barba</option>
<option value="completo">Corte + Barba</option>
<option value="design">Design Facial</option>
</select>
</div>
<div>
<label class="block text-xs font-bold text-slate-500 mb-1">Biografia/Experiência</label>
<textarea id="barber-bio" rows="3" class="input-field text-sm" placeholder="Formação, experiência, especialidades..."></textarea>
</div>
<div class="grid grid-cols-2 gap-4">
<div>
<label class="block text-xs font-bold text-slate-500 mb-1">Status</label>
<select id="barber-status" class="input-field">
<option value="active">Ativo</option>
<option value="vacation">Férias</option>
<option value="inactive">Inativo</option>
</select>
</div>
<div>
<label class="block text-xs font-bold text-slate-500 mb-1">Valor Base/Hora</label>
<input type="number" id="barber-rate" placeholder="80.00" class="input-field" step="0.01">
</div>
</div>
<div>
<label class="block text-xs font-bold text-slate-500 mb-1">Disponibilidade (Dias)</label>
<div class="grid grid-cols-7 gap-2 mt-2">
<label class="flex flex-col items-center">
<input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600" id="barber-day-sun">
<span class="text-[10px] mt-1">Dom</span>
</label>
<label class="flex flex-col items-center">
<input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600" id="barber-day-mon" checked>
<span class="text-[10px] mt-1">Seg</span>
</label>
<label class="flex flex-col items-center">
<input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600" id="barber-day-tue" checked>
<span class="text-[10px] mt-1">Ter</span>
</label>
<label class="flex flex-col items-center">
<input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600" id="barber-day-wed" checked>
<span class="text-[10px] mt-1">Qua</span>
</label>
<label class="flex flex-col items-center">
<input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600" id="barber-day-thu" checked>
<span class="text-[10px] mt-1">Qui</span>
</label>
<label class="flex flex-col items-center">
<input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600" id="barber-day-fri" checked>
<span class="text-[10px] mt-1">Sex</span>
</label>
<label class="flex flex-col items-center">
<input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600" id="barber-day-sat" checked>
<span class="text-[10px] mt-1">Sáb</span>
</label>
</div>
</div>
<button type="submit" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl hover:bg-blue-700 transition active:scale-[0.98] flex justify-center items-center gap-2">
<i class="fa-solid fa-user-tie"></i> Cadastrar Barbeiro
</button>
</form>
</div>
</div>
<div id="modal-reminder" class="modal-overlay hidden">
<div class="modal-content">
<div class="flex justify-between items-center mb-4">
<h3 class="font-bold text-lg text-gray-900">Enviar Lembrete</h3>
<button onclick="closeModal('modal-reminder')" class="w-8 h-8 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200 transition">
<i class="fa-solid fa-times"></i>
</button>
</div>
<p class="mb-4 text-gray-600" id="reminder-text">Você está prestes a enviar um lembrete para este cliente sobre seu atendimento.</p>
<div class="bg-blue-50 p-3 rounded-lg mb-4">
<p class="text-xs text-blue-800 flex items-start">
<i class="fa-solid fa-circle-info mt-1 mr-2"></i> O lembrete será enviado automaticamente 24 horas antes do agendamento com a mensagem configurada nas suas preferências.
</p>
</div>
<button onclick="sendReminderManually()" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 rounded-xl transition flex items-center justify-center">
<i class="fa-solid fa-bell mr-2"></i> Enviar Lembrete Agora
</button>
</div>
</div>
<!-- Scripts -->
<script>
// Firebase Config
const firebaseConfig = {
apiKey: "TESTE",
authDomain: "TESTE",
projectId: "TESTE",
storageBucket: "TESTE",
messagingSenderId: "TESTE",
appId: "TESTE"
};

// Initialize Firebase
let db, storage;
let loadingData = false;
let clientsLoaded = 0;
const clientsPerPage = 10;
let selectedService = null;
let servicePrices = {
"Corte Social": 35,
"Corte Degradê": 45,
"Barba Simples": 25,
"Barba Completa": 40,
"Corte + Barba": 70,
"Sobrancelha": 15
};

try {
if (!firebase.apps.length) {
firebase.initializeApp(firebaseConfig);
}
const app = firebase.apps[0];
db = app.firestore();
storage = app.storage();
db.settings({ ignoreUndefinedProperties: true });
console.log("Firebase initialized successfully");
} catch (error) {
console.error("Error initializing Firebase:", error);
showToast("Erro ao conectar com o banco de dados. Verifique sua conexão com a internet.", "error");
}

// State
const DB_PREFIX = 'barbershop_app_';
let state = {
currentDate: new Date(),
selectedDate: null,
adminDate: new Date(),
selectedSlot: null,
selectedService: null,
settings: null,
currentUser: null,
view: "view-profile",
servicePrices: {
"Corte Social": 35,
"Corte Degradê": 45,
"Barba Simples": 25,
"Barba Completa": 40,
"Corte + Barba": 70,
"Sobrancelha": 15
}
};

// Cache
let cache = {
slots: {},
bookings: [],
clients: {},
barbers: {},
lastUpdated: null
};

// Initialize App
document.addEventListener('DOMContentLoaded', () => {
const urlParams = new URLSearchParams(window.location.search);
state.view = urlParams.get('view') === 'admin' ? 'view-admin' : 'view-profile';
initApp();
});

async function initApp() {
showLoader(true);
try {
await loadSettings();
const todayISO = new Date().toISOString().split('T')[0];
state.selectedDate = todayISO;
await Promise.all([
loadSlotsCache(),
loadBookingsCache(),
loadClientsCache(),
loadBarbersCache()
]);
document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
document.getElementById(state.view).classList.add('active');
if (state.view === 'view-admin') {
renderAdminCalendar();
updateDashboard();
setupDataRefresh();
} else {
renderClientDates();
renderClientSlots();
}
console.log("App initialized successfully");
} catch (error) {
console.error("Error initializing app:", error);
showToast("Erro ao carregar os dados. Tente novamente mais tarde.", "error");
} finally {
showLoader(false);
}
}

async function loadSettings() {
try {
const settingsDoc = await db.collection('settings').doc('main').get();
if (settingsDoc.exists) {
state.settings = settingsDoc.data();
} else {
state.settings = {
confirmMsg: "Olá {nome}, confirmamos seu agendamento para {data} às {hora} para {servico}. Valor: R$ {valor}. Estamos localizados na Rua das Lâminas, 456. Chegue 10 minutos antes do horário marcado.",
reminderMsg: "Olá {nome}, lembrando do seu agendamento amanhã ({data}) às {hora} para {servico}. Estamos ansiosos para atendê-lo na BarberShop Pro!",
barbershopName: "BarberShop Pro",
address: "Rua das Lâminas, 456 - Centro",
services: "Corte Social, Corte Degradê, Barba Simples, Barba Completa, Corte + Barba, Sobrancelha",
workingDays: ["mon", "tue", "wed", "thu", "fri", "sat"],
createdAt: new Date(),
updatedAt: new Date()
};
await db.collection('settings').doc('main').set(state.settings);
}
document.getElementById('setting-msg-confirm').value = state.settings.confirmMsg;
document.getElementById('setting-msg-reminder').value = state.settings.reminderMsg;
document.getElementById('setting-barbershop-name').value = state.settings.barbershopName;
document.getElementById('setting-address').value = state.settings.address;
document.getElementById('setting-services').value = state.settings.services;
document.querySelectorAll('#tab-settings input[type="checkbox"]').forEach(checkbox => {
checkbox.checked = false;
});
(state.settings.workingDays || []).forEach(day => {
const checkbox = document.getElementById(`day-${day}`);
if (checkbox) checkbox.checked = true;
});
updateServicePrices();
} catch (error) {
console.error("Error loading settings:", error);
showToast("Erro ao carregar configurações do sistema.", "error");
}
}

function updateServicePrices() {
if (state.settings && state.settings.services) {
const services = state.settings.services.split(',').map(s => s.trim());
services.forEach(service => {
if (!state.servicePrices[service]) {
// Use default prices or set a base price
state.servicePrices[service] = 40; // Default price
}
});
}
}

async function loadSlotsCache() {
try {
const slotsSnapshot = await db.collection('slots').get();
cache.slots = {};
slotsSnapshot.forEach(doc => {
const data = doc.data();
const date = doc.id;
cache.slots[date] = data.times || [];
});
console.log("Slots cache loaded:", Object.keys(cache.slots).length, "dates");
} catch (error) {
console.error("Error loading slots cache:", error);
showToast("Erro ao carregar horários disponíveis.", "error");
}
}

async function loadBookingsCache() {
try {
const bookingsSnapshot = await db.collection('bookings')
.orderBy('date', 'desc')
.limit(100)
.get();
cache.bookings = [];
bookingsSnapshot.forEach(doc => {
const data = doc.data();
data.id = doc.id;
cache.bookings.push(data);
});
console.log("Bookings cache loaded:", cache.bookings.length, "bookings");
} catch (error) {
console.error("Error loading bookings cache:", error);
showToast("Erro ao carregar agendamentos.", "error");
}
}

async function loadClientsCache() {
try {
const clientsSnapshot = await db.collection('clients').limit(50).get();
cache.clients = {};
clientsSnapshot.forEach(doc => {
const data = doc.data();
data.id = doc.id;
cache.clients[data.phone] = data;
});
console.log("Clients cache loaded:", Object.keys(cache.clients).length, "clients");
} catch (error) {
console.error("Error loading clients cache:", error);
showToast("Erro ao carregar dados dos clientes.", "error");
}
}

async function loadBarbersCache() {
try {
const barbersSnapshot = await db.collection('barbers').get();
cache.barbers = {};
barbersSnapshot.forEach(doc => {
const data = doc.data();
data.id = doc.id;
cache.barbers[data.id] = data;
});
console.log("Barbers cache loaded:", Object.keys(cache.barbers).length, "barbers");
} catch (error) {
console.error("Error loading barbers cache:", error);
showToast("Erro ao carregar dados dos barbeiros.", "error");
}
}

function switchTab(tabId) {
document.querySelectorAll('.nav-tab').forEach(tab => {
tab.classList.remove('active');
});
document.querySelector(`button[data-tab="${tabId}"]`).classList.add('active');
document.querySelectorAll('.tab-content').forEach(content => {
content.classList.add('hidden');
});
document.getElementById(`tab-${tabId}`).classList.remove('hidden');
if (tabId === 'dashboard') updateDashboard();
if (tabId === 'calendar') renderAdminCalendar();
if (tabId === 'clients') renderClients();
if (tabId === 'financial') renderFinancial();
if (tabId === 'barbers') renderBarbers();
}

function showLoader(show) {
const loader = document.querySelector('.loader');
if (loader) {
loader.style.display = show ? 'inline-block' : 'none';
}
}

function showToast(message, type = 'success') {
const toast = document.getElementById('toast-notification');
toast.textContent = message;
toast.className = `toast ${type === 'error' ? 'error' : ''}`;
toast.classList.add('show');
setTimeout(() => {
toast.classList.remove('show');
}, 3000);
}

function setupDataRefresh() {
setInterval(async () => {
if (!loadingData) {
loadingData = true;
try {
await Promise.all([
loadSlotsCache(),
loadBookingsCache(),
loadClientsCache(),
loadBarbersCache()
]);
if (document.getElementById('tab-dashboard').classList.contains('block')) {
updateDashboard();
}
if (document.getElementById('tab-calendar').classList.contains('block')) {
renderAdminCalendar();
}
console.log("Data refreshed at", new Date().toLocaleTimeString());
} catch (error) {
console.error("Error refreshing ", error);
} finally {
loadingData = false;
}
}
}, 30000);
}

// Navigation
function navigateTo(viewId) {
if (viewId === 'view-admin') {
window.history.pushState({}, '', '?view=admin');
state.view = 'view-admin';
} else {
window.history.pushState({}, '', window.location.pathname);
state.view = 'view-profile';
}
document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
document.getElementById(viewId).classList.add('active');
window.scrollTo(0, 0);
if (viewId === 'view-admin') {
renderAdminCalendar();
updateDashboard();
}
}

function checkAdmin() {
navigateTo('view-admin');
}

function logoutAdmin() {
window.history.pushState({}, '', window.location.pathname);
state.view = 'view-profile';
navigateTo('view-profile');
showToast("Você saiu do painel administrativo.");
}

// Client View Functions
function clientChangeDate(days) {
const current = new Date(state.selectedDate + 'T00:00:00');
current.setDate(current.getDate() + days);
state.selectedDate = current.toISOString().split('T')[0];
renderClientDates();
renderClientSlots();
}

function setClientDate(dateIso) {
state.selectedDate = dateIso;
renderClientDates();
renderClientSlots();
}

function renderClientDates() {
const container = document.getElementById('client-date-scroll');
const monthDisplay = document.getElementById('client-month-display');
container.innerHTML = '';
const baseDate = new Date(state.selectedDate + 'T00:00:00');
monthDisplay.innerText = baseDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
for (let i = -3; i <= 3; i++) {
const d = new Date(baseDate);
d.setDate(baseDate.getDate() + i);
const iso = d.toISOString().split('T')[0];
const dayNum = d.getDate();
const weekDay = d.toLocaleDateString('pt-BR', { weekday: 'short' }).slice(0, 3);
const allSlots = cache.slots[iso] || [];
const bookings = cache.bookings.filter(b => b.date === iso).map(b => b.time);
const available = allSlots.filter(s => !bookings.includes(s)).length > 0;
const dayOfWeek = d.getDay();
const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
const btn = document.createElement('div');
btn.className = `calendar-day flex-shrink-0 w-14 h-16 border ${iso === state.selectedDate ? 'selected' : isWeekend ? 'bg-rose-50 border-rose-200' : 'bg-white border-gray-100'} ${available ? 'has-slots' : ''}`;
btn.onclick = () => setClientDate(iso);
btn.innerHTML = `
<span class="text-[10px] uppercase ${isWeekend ? 'text-rose-500' : 'opacity-60'}">${weekDay}</span>
<span class="text-xl font-medium">${dayNum}</span>
`;
container.appendChild(btn);
}
}

function renderClientSlots() {
const grid = document.getElementById('client-slots-grid');
const empty = document.getElementById('client-empty-state');
const confirmBar = document.getElementById('client-confirm-bar');
grid.innerHTML = '';
state.selectedSlot = null;
confirmBar.classList.remove('translate-y-0');
confirmBar.classList.add('translate-y-full');
const today = new Date().toISOString().split('T')[0];
const isPastDate = state.selectedDate < today;
if (isPastDate) {
empty.classList.remove('hidden');
empty.innerHTML = `
<div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3 text-gray-400">
<i class="fa-regular fa-calendar-days text-2xl"></i>
</div>
<p class="text-gray-500 text-sm">Não é possível agendar em datas passadas.</p>
`;
return;
}
const allSlots = cache.slots[state.selectedDate] || [];
const bookings = cache.bookings.filter(b => b.date === state.selectedDate).map(b => b.time);
allSlots.sort();
if (allSlots.length === 0 || allSlots.length === bookings.length) {
empty.classList.remove('hidden');
if (allSlots.length === 0) {
empty.querySelector('i').className = 'fa-regular fa-calendar-plus text-2xl';
empty.querySelector('p').innerText = 'Não há horários cadastrados para esta data.';
} else {
empty.querySelector('i').className = 'fa-regular fa-calendar-xmark text-2xl';
empty.querySelector('p').innerText = 'Todos os horários já foram agendados.';
}
return;
}
empty.classList.add('hidden');
allSlots.forEach(time => {
const isBooked = bookings.includes(time);
const btn = document.createElement('button');
btn.className = `time-slot p-3 rounded-xl font-medium text-sm text-center transition-all duration-200 ${isBooked ? 'booked' : 'bg-white text-gray-700 hover:border-blue-500 hover:shadow-sm'}`;
btn.innerText = time;
if (!isBooked) {
btn.onclick = () => selectSlot(btn, time);
}
grid.appendChild(btn);
});
}

function selectSlot(el, time) {
document.querySelectorAll('.time-slot').forEach(t => {
t.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-600');
});
el.classList.add('selected');
state.selectedSlot = time;
const date = new Date(state.selectedDate + 'T00:00:00');
const dateFmt = date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
document.getElementById('client-selected-info').innerText = `${dateFmt} às ${time}`;
updateConfirmButton();
}

function selectService(serviceName) {
selectedService = serviceName;
document.querySelectorAll('.service-btn').forEach(btn => {
btn.classList.remove('border-blue-500', 'bg-blue-100');
});
event.currentTarget.classList.add('border-blue-500', 'bg-blue-100');
document.getElementById('client-selected-service').innerText = serviceName;
document.getElementById('client-selected-price').innerText = `R$ ${servicePrices[serviceName] || 35},00`;
updateConfirmButton();
}

function updateConfirmButton() {
const confirmBtn = document.getElementById('confirm-booking-btn');
if (state.selectedSlot && selectedService) {
confirmBtn.disabled = false;
confirmBtn.className = confirmBtn.className.replace('bg-gray-300 cursor-not-allowed', 'bg-blue-600 hover:bg-blue-700 cursor-pointer');
confirmBtn.innerHTML = '<i class="fa-solid fa-check"></i> Confirmar Agendamento';
} else {
confirmBtn.disabled = true;
confirmBtn.className = confirmBtn.className.replace('bg-blue-600 hover:bg-blue-700 cursor-pointer', 'bg-gray-300 cursor-not-allowed');
confirmBtn.innerHTML = '<i class="fa-solid fa-check"></i> Selecione um serviço e horário';
}
}

function openBookingModal() {
if (!state.selectedSlot || !selectedService) {
showToast("Por favor, selecione um horário e serviço antes de prosseguir.", "error");
return;
}
document.getElementById('modal-booking').classList.remove('hidden');
document.getElementById('book-name').value = '';
document.getElementById('book-phone').value = '';
document.getElementById('book-email').value = '';
document.getElementById('book-service').value = selectedService;
document.getElementById('book-source').value = 'indication';
}

async function confirmBooking(e) {
e.preventDefault();
const name = document.getElementById('book-name').value.trim();
let phone = document.getElementById('book-phone').value.trim();
const email = document.getElementById('book-email').value.trim();
const service = document.getElementById('book-service').value;
const source = document.getElementById('book-source').value;
phone = phone.replace(/\D/g, '');
if (phone.length === 10) {
phone = phone.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
} else if (phone.length === 11) {
phone = phone.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
}
if (!name || !phone || !service) {
showToast("Por favor, preencha todos os campos obrigatórios.", "error");
return;
}
if (!validatePhone(phone)) {
showToast("Número de WhatsApp inválido. Use o formato (11) 99999-9999", "error");
return;
}
showLoader(true);
try {
const formattedPhone = formatPhone(phone);
const value = servicePrices[service] || 35;
let clientData = cache.clients[formattedPhone];
if (!clientData) {
clientData = {
name: name,
phone: formattedPhone,
email: email || null,
source: source,
serviceHistory: [service],
createdAt: new Date(),
updatedAt: new Date(),
lastVisit: state.selectedDate,
totalVisits: 1
};
const clientRef = db.collection('clients').doc(formattedPhone);
await clientRef.set(clientData);
cache.clients[formattedPhone] = clientData;
} else {
clientData.lastVisit = state.selectedDate;
clientData.totalVisits = (clientData.totalVisits || 0) + 1;
if (!clientData.serviceHistory) clientData.serviceHistory = [];
clientData.serviceHistory.push(service);
clientData.updatedAt = new Date();
await db.collection('clients').doc(formattedPhone).update({
lastVisit: state.selectedDate,
totalVisits: firebase.firestore.FieldValue.increment(1),
serviceHistory: firebase.firestore.FieldValue.arrayUnion(service),
updatedAt: new Date()
});
}
const bookingId = db.collection('bookings').doc().id;
const bookingData = {
id: bookingId,
date: state.selectedDate,
time: state.selectedSlot,
clientName: name,
clientPhone: formattedPhone,
clientEmail: email || null,
clientSource: source,
service: service,
value: value,
status: 'confirmed',
createdAt: new Date(),
updatedAt: new Date(),
reminderSent: false
};
await db.collection('bookings').doc(bookingId).set(bookingData);
cache.bookings.unshift(bookingData);
if (cache.bookings.length > 100) cache.bookings.pop();
closeModal('modal-booking');
const formattedDate = state.selectedDate.split('-').reverse().join('/');
const clientFirstName = name.split(' ')[0];
let message = (state.settings?.confirmMsg || "Olá {nome}, confirmamos seu agendamento para {data} às {hora} para {servico}.")
.replace('{nome}', clientFirstName)
.replace('{data}', formattedDate)
.replace('{hora}', state.selectedSlot)
.replace('{servico}', service)
.replace('{valor}', value);
showToast("Agendamento confirmado com sucesso! Um WhatsApp será enviado com os detalhes.");
setTimeout(() => {
renderClientSlots();
renderClientDates();
navigateTo('view-profile');
}, 1500);
} catch (error) {
console.error("Error confirming booking:", error);
showToast("Erro ao confirmar agendamento. Tente novamente.", "error");
} finally {
showLoader(false);
}
}

function validatePhone(phone) {
const digits = phone.replace(/\D/g, '');
return digits.length === 10 || digits.length === 11;
}

function formatPhone(phone) {
const digits = phone.replace(/\D/g, '');
if (digits.length === 10) {
return `(${digits.substring(0,2)}) ${digits.substring(2,6)}-${digits.substring(6,10)}`;
} else if (digits.length === 11) {
return `(${digits.substring(0,2)}) ${digits.substring(2,7)}-${digits.substring(7,11)}`;
}
return phone;
}

// Admin View Functions
function changeAdminMonth(delta) {
state.adminDate.setMonth(state.adminDate.getMonth() + delta);
renderAdminCalendar();
}

async function renderAdminCalendar() {
const grid = document.getElementById('admin-calendar-grid');
const title = document.getElementById('admin-calendar-month');
grid.innerHTML = '<div class="col-span-7 text-center py-8"><div class="loader mx-auto"></div></div>';
const year = state.adminDate.getFullYear();
const month = state.adminDate.getMonth();
title.innerText = state.adminDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
const firstDay = new Date(year, month, 1).getDay();
const daysInMonth = new Date(year, month + 1, 0).getDate();
const monthStart = new Date(year, month, 1).toISOString().split('T')[0];
const monthEnd = new Date(year, month + 1, 0).toISOString().split('T')[0];
const monthBookings = cache.bookings.filter(b =>
b.date >= monthStart && b.date <= monthEnd
);
const bookingsByDate = {};
monthBookings.forEach(booking => {
if (!bookingsByDate[booking.date]) {
bookingsByDate[booking.date] = [];
}
bookingsByDate[booking.date].push(booking);
});
grid.innerHTML = '';
for (let i = 0; i < firstDay; i++) {
grid.innerHTML += '<div class="bg-slate-50 h-24"></div>';
}
for (let d = 1; d <= daysInMonth; d++) {
const date = new Date(year, month, d);
const iso = date.toISOString().split('T')[0];
const dayOfWeek = date.getDay();
const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
const slots = cache.slots[iso] || [];
const dayBookings = bookingsByDate[iso] || [];
const today = new Date().toISOString().split('T')[0];
const isToday = iso === today;
let statusClass = 'bg-white text-slate-700';
let statusText = '';
if (slots.length === 0) {
statusClass = 'bg-slate-50 text-slate-400';
statusText = 'Sem horários';
} else if (dayBookings.length >= slots.length) {
statusClass = 'bg-red-50 text-red-700';
statusText = 'Esgotado';
} else if (dayBookings.length > 0) {
statusClass = 'bg-blue-50 text-blue-700';
statusText = `${dayBookings.length}/${slots.length}`;
} else {
statusClass = 'bg-white text-slate-700';
statusText = `${slots.length} horários`;
}
if (isToday) {
statusClass += ' border-2 border-blue-500 shadow-sm';
} else if (isWeekend) {
statusClass += ' border border-rose-200 bg-rose-50 text-rose-700';
} else {
statusClass += ' border border-slate-100';
}
const dayEl = document.createElement('div');
dayEl.className = `h-24 p-1 cursor-pointer hover:bg-slate-100 transition relative flex flex-col items-center justify-center rounded-lg ${statusClass}`;
dayEl.onclick = () => openDayModal(iso);
let dotColor = '';
if (dayBookings.length > 0) {
if (dayBookings.length >= slots.length) {
dotColor = 'bg-red-500';
} else {
dotColor = 'bg-blue-500';
}
}
dayEl.innerHTML = `
<div class="absolute top-1 right-1 flex space-x-0.5">
${isToday ? '<span class="w-1.5 h-1.5 bg-blue-500 rounded-full"></span>' : ''}
${isWeekend ? '<span class="w-1.5 h-1.5 bg-rose-500 rounded-full"></span>' : ''}
</div>
<span class="text-sm font-medium z-10">${d}</span>
${dayBookings.length > 0 ? `
<span class="absolute bottom-1 flex space-x-0.5 z-10">
${Array.from({length: Math.min(3, dayBookings.length)}, (_, i) =>
`<span class="w-1 h-1 ${dotColor} rounded-full"></span>`
).join('')}
${dayBookings.length > 3 ? `<span class="w-1 h-1 bg-gray-400 rounded-full"></span>` : ''}
</span>
` : ''}
<span class="text-[9px] mt-1 opacity-80 z-10">${statusText}</span>
`;
grid.appendChild(dayEl);
}
}

let currentModalDate = null;
function openDayModal(iso) {
currentModalDate = iso;
const date = new Date(iso + 'T00:00:00');
document.getElementById('modal-day-title').innerText = date.getDate();
document.getElementById('modal-day-date').innerHTML = `
<i class="fa-regular fa-calendar-days mr-1 text-slate-400"></i>
${date.toLocaleDateString('pt-BR', { weekday: 'long', month: 'long' })} de ${date.getFullYear()}
`;
document.getElementById('modal-day').classList.remove('hidden');
switchDayTab('slots');
renderAdminDaySlots();
renderAdminDayBookings();
}

function switchDayTab(tab) {
if (tab === 'slots') {
document.getElementById('day-content-slots').classList.remove('hidden');
document.getElementById('day-content-bookings').classList.add('hidden');
document.getElementById('btn-tab-day-slots').className = "flex-1 pb-2 text-sm font-bold text-blue-600 border-b-2 border-blue-600";
document.getElementById('btn-tab-day-bookings').className = "flex-1 pb-2 text-sm font-bold text-slate-400 border-b-2 border-transparent";
} else {
document.getElementById('day-content-slots').classList.add('hidden');
document.getElementById('day-content-bookings').classList.remove('hidden');
document.getElementById('btn-tab-day-slots').className = "flex-1 pb-2 text-sm font-bold text-slate-400 border-b-2 border-transparent";
document.getElementById('btn-tab-day-bookings').className = "flex-1 pb-2 text-sm font-bold text-blue-600 border-b-2 border-blue-600";
}
}

function renderAdminDaySlots() {
const list = document.getElementById('admin-slots-list');
list.innerHTML = '<div class="col-span-full text-center py-4"><div class="loader mx-auto"></div></div>';
setTimeout(() => {
const daySlots = cache.slots[currentModalDate] || [];
const bookings = cache.bookings.filter(b => b.date === currentModalDate).map(b => b.time);
if (daySlots.length === 0) {
list.innerHTML = `
<div class="text-center py-8 text-slate-500 col-span-full">
<i class="fa-regular fa-clock text-3xl opacity-50 mb-2 block"></i>
<p>Nenhum horário cadastrado para este dia</p>
<p class="text-xs mt-1">Use o gerador rápido ou adicione manualmente</p>
</div>
`;
return;
}
list.innerHTML = '';
daySlots.forEach(time => {
const isBooked = bookings.includes(time);
const el = document.createElement('div');
el.className = `flex items-center justify-between p-2.5 rounded-lg text-xs font-medium border ${isBooked ? 'bg-blue-50 border-blue-200 text-blue-800' : 'bg-white border-slate-200 text-slate-700 hover:border-blue-300'}`;
el.innerHTML = `
<span class="font-bold">${time}</span>
${!isBooked ? `
<button onclick="removeSlot('${time}')" class="text-red-500 hover:text-red-700 transition" title="Remover horário">
<i class="fa-solid fa-trash-can text-sm"></i>
</button>
` : `
<span class="text-green-600 flex items-center">
<i class="fa-solid fa-check-circle mr-1"></i> Agendado
</span>
`}
`;
list.appendChild(el);
});
}, 300);
}

function renderAdminDayBookings() {
const container = document.getElementById('day-content-bookings');
container.innerHTML = '<div class="text-center py-6"><div class="loader mx-auto mb-2"></div><p class="text-slate-500 text-sm">Carregando agendamentos...</p></div>';
setTimeout(() => {
const bookings = cache.bookings
.filter(b => b.date === currentModalDate)
.sort((a, b) => a.time.localeCompare(b.time));
if (bookings.length === 0) {
container.innerHTML = `
<div class="text-center py-8 text-slate-500">
<i class="fa-regular fa-calendar-plus text-3xl opacity-50 mb-2 block"></i>
<p class="font-medium">Nenhum agendamento para este dia</p>
<p class="text-xs mt-1">Os horários disponíveis aparecerão aqui quando agendados</p>
</div>
`;
return;
}
container.innerHTML = '';
bookings.forEach(booking => {
const client = cache.clients[booking.clientPhone] || { name: booking.clientName, email: booking.clientEmail };
const isToday = booking.date === new Date().toISOString().split('T')[0];
const sessionIsPast = isToday && booking.time < new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
const card = document.createElement('div');
card.className = `booking-card bg-white p-4 rounded-xl border border-slate-100 shadow-sm mb-3 ${sessionIsPast ? 'opacity-70 border-l-4 border-l-gray-400' : ''}`;
let serviceBadge = 'service-cut';
if (booking.service.includes('Barba')) serviceBadge = 'service-beard';
if (booking.service.includes('+')) serviceBadge = 'service-complete';
card.innerHTML = `
<div class="flex justify-between items-start mb-3">
<div class="min-w-0">
<div class="flex items-center mb-1">
<span class="service-badge ${serviceBadge}">${booking.service}</span>
<span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded ml-2">${booking.status === 'confirmed' ? 'Confirmado' : 'Pendente'}</span>
</div>
<h4 class="font-bold text-slate-800 text-base truncate" title="${client.name}">${client.name}</h4>
<div class="flex flex-wrap gap-2 mt-1">
${client.email ? `<span class="text-[10px] text-slate-500 flex items-center"><i class="fa-solid fa-envelope mr-1 text-slate-400"></i> ${client.email}</span>` : ''}
<span class="text-[10px] text-slate-500 flex items-center">
<i class="fa-solid fa-money-bill mr-1 text-green-500"></i> R$ ${booking.value},00
</span>
</div>
</div>
<div class="flex flex-col items-end space-y-1">
${!sessionIsPast ? `
<button onclick="openReminderModal('${booking.id}', '${client.name}')" class="w-7 h-7 bg-amber-50 text-amber-600 rounded-lg flex items-center justify-center hover:bg-amber-100 transition" title="Enviar lembrete">
<i class="fa-solid fa-bell text-xs"></i>
</button>` : ''}
<button onclick="deleteBooking('${booking.id}', '${client.name}')" class="w-7 h-7 bg-red-50 text-red-600 rounded-lg flex items-center justify-center hover:bg-red-100 transition" title="Cancelar agendamento">
<i class="fa-solid fa-xmark text-sm"></i>
</button>
</div>
</div>
<div class="flex gap-2 mt-3">
<a href="https://wa.me/55${booking.clientPhone.replace(/\D/g,'')}" target="_blank" class="flex-1 bg-green-50 text-green-700 text-center py-2 rounded-lg text-xs font-medium hover:bg-green-100 transition">
<i class="fa-brands fa-whatsapp mr-1"></i> WhatsApp
</a>
</div>
${booking.createdAt ? `
<div class="mt-3 pt-3 border-t border-slate-100 text-[10px] text-slate-400">
<i class="fa-solid fa-clock mr-1"></i> Agendado em: ${new Date(booking.createdAt.toDate()).toLocaleDateString('pt-BR')} às ${new Date(booking.createdAt.toDate()).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
</div>` : ''}
`;
container.appendChild(card);
});
}, 300);
}

async function addSlot() {
const timeInput = document.getElementById('new-slot-time');
const time = timeInput.value;
if (!time) {
showToast("Selecione um horário válido", "error");
return;
}
const [hours, minutes] = time.split(':');
if (parseInt(hours) < 8 || parseInt(hours) > 21) {
showToast("Horário fora do período comercial (8h-21h)", "error");
return;
}
try {
showLoader(true);
let daySlots = cache.slots[currentModalDate] || [];
if (daySlots.includes(time)) {
showToast("Este horário já está cadastrado para este dia", "error");
return;
}
daySlots.push(time);
daySlots.sort();
await db.collection('slots').doc(currentModalDate).set({
times: daySlots,
date: currentModalDate,
updatedAt: new Date()
});
cache.slots[currentModalDate] = daySlots;
timeInput.value = '';
renderAdminDaySlots();
renderAdminCalendar();
showToast("Horário adicionado com sucesso!");
} catch (error) {
console.error("Error adding slot:", error);
showToast("Erro ao adicionar horário. Tente novamente.", "error");
} finally {
showLoader(false);
}
}

async function updateDashboard() {
showLoader(true);
try {
const now = new Date();
const today = now.toISOString().split('T')[0];
const currentMonth = now.toISOString().slice(0, 7);
const upcoming = cache.bookings
.filter(b => {
const bookingDateTime = new Date(`${b.date}T${b.time}:00`);
return bookingDateTime >= now;
})
.sort((a, b) => {
const dateA = new Date(`${a.date}T${a.time}`);
const dateB = new Date(`${b.date}T${b.time}`);
return dateA - dateB;
});
if (upcoming.length > 0) {
const next = upcoming[0];
const isToday = next.date === today;
document.getElementById('dash-next-badge').innerText = isToday ? 'HOJE' : next.date.split('-').reverse().join('/');
document.getElementById('dash-next-time').innerText = next.time;
document.getElementById('dash-next-client').innerText = next.clientName;
document.getElementById('dash-next-service').innerText = next.service;
document.getElementById('dash-next-content').dataset.nextPhone = next.clientPhone;
document.getElementById('dash-next-content').dataset.nextName = next.clientName;
document.getElementById('dash-next-content').dataset.nextId = next.id;
document.getElementById('dash-next-content').dataset.nextService = next.service;
} else {
document.getElementById('dash-next-time').innerText = "--:--";
document.getElementById('dash-next-client').innerText = "Nenhum agendamento futuro";
document.getElementById('dash-next-service').innerText = "";
document.getElementById('dash-next-badge').innerText = "";
}
const uniqueClients = Object.keys(cache.clients).length;
const monthSessions = cache.bookings.filter(b => b.date.startsWith(currentMonth)).length;
const monthRevenue = cache.bookings
.filter(b => b.date.startsWith(currentMonth) && b.status === 'confirmed')
.reduce((sum, booking) => sum + (booking.value || 35), 0);
const last7Days = [];
for (let i = 0; i < 7; i++) {
const date = new Date();
date.setDate(date.getDate() - i);
last7Days.push(date.toISOString().split('T')[0]);
}
let totalSlots = 0;
let bookedSlots = 0;
last7Days.forEach(date => {
const slots = cache.slots[date] || [];
const bookings = cache.bookings.filter(b => b.date === date).length;
totalSlots += slots.length;
bookedSlots += Math.min(bookings, slots.length);
});
const availability = totalSlots > 0 ? Math.round(((totalSlots - bookedSlots) / totalSlots) * 100) : 0;
document.getElementById('dash-total-clients').innerText = uniqueClients;
document.getElementById('dash-month-count').innerText = monthSessions;
document.getElementById('dash-month-revenue').innerText = monthRevenue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
document.getElementById('dash-availability').innerText = `${availability}%`;
loadUpcomingAppointments();
loadRecentClients();
} catch (error) {
console.error("Error updating dashboard:", error);
showToast("Erro ao atualizar o dashboard. Tente novamente.", "error");
} finally {
showLoader(false);
}
}

function loadUpcomingAppointments() {
const container = document.getElementById('upcoming-appointments');
container.innerHTML = '';
const now = new Date();
const next7Days = [];
for (let i = 0; i < 7; i++) {
const date = new Date();
date.setDate(date.getDate() + i);
next7Days.push(date.toISOString().split('T')[0]);
}
const upcoming = cache.bookings
.filter(b => next7Days.includes(b.date) && new Date(`${b.date}T${b.time}`) >= now)
.sort((a, b) => {
const dateA = new Date(`${a.date}T${a.time}`);
const dateB = new Date(`${b.date}T${b.time}`);
return dateA - dateB;
});
if (upcoming.length === 0) {
container.innerHTML = `
<div class="empty-state py-8">
<i class="fa-regular fa-calendar-check text-slate-300"></i>
<h4 class="font-bold text-lg text-slate-700">Nenhum agendamento nos próximos dias</h4>
<p class="text-slate-500">Cadastre novos horários na aba de Agenda</p>
</div>
`;
return;
}
upcoming.forEach(booking => {
const date = new Date(booking.date + 'T00:00:00');
const client = cache.clients[booking.clientPhone] || { name: booking.clientName };
const isToday = booking.date === new Date().toISOString().split('T')[0];
const dayName = date.toLocaleDateString('pt-BR', { weekday: 'short' }).charAt(0).toUpperCase() + date.toLocaleDateString('pt-BR', { weekday: 'short' }).slice(1, 3);
const dayNumber = date.getDate();
let serviceBadge = 'text-blue-600';
if (booking.service.includes('Barba')) serviceBadge = 'text-amber-600';
if (booking.service.includes('+')) serviceBadge = 'text-green-600';
const appointmentEl = document.createElement('div');
appointmentEl.className = `flex items-center p-3 rounded-lg mb-2 border-l-4 ${isToday ? 'border-blue-500 bg-blue-50' : 'border-slate-300 bg-slate-50'}`;
appointmentEl.innerHTML = `
<div class="mr-4 text-center min-w-[50px]">
<div class="font-bold text-slate-700">${dayName}</div>
<div class="text-lg font-bold text-slate-800">${dayNumber}</div>
</div>
<div class="flex-1 min-w-0">
<div class="flex justify-between items-start">
<div>
<h4 class="font-bold text-slate-800 truncate" title="${client.name}">${client.name}</h4>
<div class="flex items-center mt-1 text-sm">
<span class="font-medium ${serviceBadge}">${booking.service}</span>
<span class="text-xs text-slate-500 ml-2">${booking.date.split('-').reverse().join('/')}</span>
</div>
</div>
<span class="text-sm font-bold text-green-600">R$ ${booking.value},00</span>
</div>
</div>
<div class="ml-3 flex flex-col items-end space-y-1">
<a href="https://wa.me/55${booking.clientPhone.replace(/\D/g,'')}" target="_blank" class="w-8 h-8 bg-green-100 text-green-700 rounded-lg flex items-center justify-center hover:bg-green-200 transition" title="WhatsApp">
<i class="fa-brands fa-whatsapp text-sm"></i>
</a>
</div>
`;
container.appendChild(appointmentEl);
});
}

function loadRecentClients() {
const container = document.getElementById('recent-clients');
container.innerHTML = '';
const recentClients = Object.values(cache.clients)
.filter(client => client.lastVisit)
.sort((a, b) => new Date(b.lastVisit) - new Date(a.lastVisit))
.slice(0, 5);
if (recentClients.length === 0) {
container.innerHTML = `
<div class="empty-state py-6">
<i class="fa-solid fa-users text-slate-300"></i>
<p class="text-slate-500">Nenhum cliente cadastrado ainda</p>
</div>
`;
return;
}
recentClients.forEach(client => {
const lastVisitDate = new Date(client.lastVisit + 'T00:00:00');
const formattedDate = lastVisitDate.toLocaleDateString('pt-BR');
const totalVisits = client.totalVisits || 1;
const clientEl = document.createElement('div');
clientEl.className = "flex items-center p-3 border-b border-slate-100 last:border-b-0";
clientEl.innerHTML = `
<div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-3 flex-shrink-0">
<span class="font-bold text-blue-700 text-sm">${client.name.charAt(0)}</span>
</div>
<div class="flex-1 min-w-0">
<h4 class="font-bold text-slate-800 truncate" title="${client.name}">${client.name}</h4>
<div class="flex flex-wrap gap-2 mt-1">
<span class="text-[11px] text-slate-500 flex items-center">
<i class="fa-solid fa-calendar-day mr-1 text-slate-400"></i> Última visita: ${formattedDate}
</span>
<span class="text-[11px] text-slate-500 flex items-center">
<i class="fa-solid fa-scissors mr-1 text-slate-400"></i> ${totalVisits} visita${totalVisits !== 1 ? 's' : ''}
</span>
</div>
</div>
<a href="https://wa.me/55${client.phone.replace(/\D/g,'')}" target="_blank" class="w-8 h-8 bg-green-50 text-green-600 rounded-lg flex items-center justify-center hover:bg-green-100 transition" title="WhatsApp">
<i class="fa-brands fa-whatsapp text-sm"></i>
</a>
`;
container.appendChild(clientEl);
});
}

function openNextClientDetails() {
const el = document.getElementById('dash-next-content');
const name = el.dataset.nextName;
const service = el.dataset.nextService;
showToast(`Próximo cliente: ${name} - Serviço: ${service}`);
}

// Modal Functions
function closeModal(modalId) {
document.getElementById(modalId).classList.add('hidden');
}

document.querySelectorAll('.modal-overlay').forEach(overlay => {
overlay.addEventListener('click', (e) => {
if (e.target === overlay) {
overlay.classList.add('hidden');
}
});
});

// New Client Modal
async function openNewClientModal() {
document.getElementById('modal-new-client').classList.remove('hidden');
document.getElementById('client-name').value = '';
document.getElementById('client-phone').value = '';
document.getElementById('client-email').value = '';
document.getElementById('client-preferred-barber').value = '';
document.getElementById('client-service-history').value = '';
}

async function saveNewClient(e) {
e.preventDefault();
const name = document.getElementById('client-name').value.trim();
let phone = document.getElementById('client-phone').value.trim();
const email = document.getElementById('client-email').value.trim();
const preferredBarber = document.getElementById('client-preferred-barber').value;
const serviceHistory = document.getElementById('client-service-history').value.trim();
phone = phone.replace(/\D/g, '');
if (phone.length === 10) {
phone = phone.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
} else if (phone.length === 11) {
phone = phone.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
}
if (!name || !phone) {
showToast("Nome e WhatsApp são obrigatórios para cadastro.", "error");
return;
}
if (!validatePhone(phone)) {
showToast("Número de WhatsApp inválido. Use o formato (11) 99999-9999", "error");
return;
}
showLoader(true);
try {
const formattedPhone = formatPhone(phone);
if (cache.clients[formattedPhone]) {
showToast("Este cliente já está cadastrado no sistema.", "error");
return;
}
const clientData = {
name: name,
phone: formattedPhone,
email: email || null,
preferredBarber: preferredBarber || null,
serviceHistory: serviceHistory ? [serviceHistory] : [],
source: 'manual',
createdAt: new Date(),
updatedAt: new Date(),
lastVisit: null,
totalVisits: 0
};
await db.collection('clients').doc(formattedPhone).set(clientData);
cache.clients[formattedPhone] = clientData;
closeModal('modal-new-client');
renderClients();
updateDashboard();
showToast("Novo cliente cadastrado com sucesso!");
} catch (error) {
console.error("Error saving new client:", error);
showToast("Erro ao cadastrar novo cliente. Tente novamente.", "error");
} finally {
showLoader(false);
}
}

// New Barber Modal
async function openNewBarberModal() {
document.getElementById('modal-new-barber').classList.remove('hidden');
document.getElementById('barber-name').value = '';
document.getElementById('barber-phone').value = '';
document.getElementById('barber-email').value = '';
document.getElementById('barber-specialty').value = '';
document.getElementById('barber-bio').value = '';
document.getElementById('barber-status').value = 'active';
document.getElementById('barber-rate').value = '80.00';
document.querySelectorAll('#modal-new-barber input[type="checkbox"]').forEach(checkbox => {
checkbox.checked = false;
});
// Check weekdays by default
['mon', 'tue', 'wed', 'thu', 'fri', 'sat'].forEach(day => {
const checkbox = document.getElementById(`barber-day-${day}`);
if (checkbox) checkbox.checked = true;
});
}

async function saveNewBarber(e) {
e.preventDefault();
const name = document.getElementById('barber-name').value.trim();
const phone = document.getElementById('barber-phone').value.trim();
const email = document.getElementById('barber-email').value.trim();
const specialty = document.getElementById('barber-specialty').value;
const bio = document.getElementById('barber-bio').value.trim();
const status = document.getElementById('barber-status').value;
const rate = parseFloat(document.getElementById('barber-rate').value) || 80.00;
const workingDays = [];
document.querySelectorAll('#modal-new-barber input[type="checkbox"]:checked').forEach(checkbox => {
const day = checkbox.id.replace('barber-day-', '');
workingDays.push(day);
});
if (!name || !email || !specialty) {
showToast("Nome, e-mail e especialidade são obrigatórios para cadastro.", "error");
return;
}
showLoader(true);
try {
const barberId = db.collection('barbers').doc().id;
const barberData = {
id: barberId,
name: name,
phone: phone || null,
email: email,
specialty: specialty,
bio: bio || null,
status: status,
hourlyRate: rate,
workingDays: workingDays,
createdAt: new Date(),
updatedAt: new Date()
};
await db.collection('barbers').doc(barberId).set(barberData);
cache.barbers[barberId] = barberData;
closeModal('modal-new-barber');
renderBarbers();
showToast("Novo barbeiro cadastrado com sucesso!");
} catch (error) {
console.error("Error saving new barber:", error);
showToast("Erro ao cadastrar novo barbeiro. Tente novamente.", "error");
} finally {
showLoader(false);
}
}

function renderBarbers() {
const container = document.getElementById('barbers-list');
container.innerHTML = '<div class="flex justify-center items-center py-10 col-span-full"><div class="text-center"><div class="loader mx-auto mb-3"></div><p class="text-slate-500">Carregando barbeiros...</p></div></div>';
setTimeout(() => {
if (Object.keys(cache.barbers).length === 0) {
container.innerHTML = `
<div class="empty-state py-10 col-span-full">
<i class="fa-solid fa-scissors text-slate-300"></i>
<h4 class="font-bold text-lg text-slate-700">Nenhum barbeiro cadastrado</h4>
<p class="text-slate-500">Cadastre seu primeiro barbeiro para começar</p>
<button onclick="openNewBarberModal()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition">
<i class="fa-solid fa-user-tie mr-1"></i> Cadastrar Barbeiro
</button>
</div>
`;
return;
}
container.innerHTML = '';
Object.values(cache.barbers).forEach(barber => {
const statusClass = barber.status === 'active' ? 'bg-green-100 text-green-800' : 
barber.status === 'vacation' ? 'bg-amber-100 text-amber-800' : 'bg-red-100 text-red-800';
const statusText = barber.status === 'active' ? 'Ativo' : 
barber.status === 'vacation' ? 'Férias' : 'Inativo';
const card = document.createElement('div');
card.className = "bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden";
card.innerHTML = `
<div class="p-4 border-b border-slate-100">
<div class="flex items-start">
<div class="barber-avatar w-12 h-12 text-lg mr-3">${barber.name.charAt(0)}</div>
<div class="flex-1 min-w-0">
<h3 class="font-bold text-lg text-slate-800 truncate">${barber.name}</h3>
<div class="flex flex-wrap gap-2 mt-1">
<span class="text-xs px-2 py-0.5 rounded-full ${statusClass} font-medium">${statusText}</span>
<span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full">${barber.specialty === 'corte' ? 'Cortes' : barber.specialty === 'barba' ? 'Barba' : barber.specialty === 'completo' ? 'Completo' : 'Design'}</span>
<span class="text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded-full">R$ ${barber.hourlyRate}/h</span>
</div>
</div>
<div class="ml-2 flex flex-col space-y-1">
<button class="w-8 h-8 bg-slate-100 rounded-lg flex items-center justify-center hover:bg-slate-200">
<i class="fa-solid fa-pen-to-square text-slate-600"></i>
</button>
<button class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center hover:bg-red-200">
<i class="fa-solid fa-trash-can text-red-600"></i>
</button>
</div>
</div>
</div>
<div class="p-4">
<p class="text-sm text-slate-600 line-clamp-2">${barber.bio || 'Sem biografia cadastrada.'}</p>
<div class="mt-3 pt-3 border-t border-slate-100 flex justify-between items-center">
<div class="text-xs">
<span class="text-slate-400 mr-1">Dias de trabalho:</span>
<span class="font-medium text-slate-700">${barber.workingDays.map(d => d.charAt(0).toUpperCase() + d.slice(1)).join(', ')}</span>
</div>
<a href="mailto:${barber.email}" class="text-blue-600 hover:text-blue-800 text-xs font-medium">
<i class="fa-solid fa-envelope mr-1"></i> E-mail
</a>
</div>
</div>
`;
container.appendChild(card);
});
}, 300);
}

// Bulk Generate Slots
function bulkGenerate(period) {
const periodText = period === 'morning' ? 'manhã (09-12h)' :
period === 'afternoon' ? 'tarde (13-18h)' :
period === 'evening' ? 'noite (19-20h)' :
'o dia todo (09-20h)';
const dateObj = new Date(currentModalDate);
const formattedDate = dateObj.toLocaleDateString('pt-BR');
document.getElementById('bulk-generate-message').innerHTML =
`Você está prestes a gerar horários para a ${periodText}.<br><span class="font-medium text-gray-800">Dia selecionado: ${formattedDate}</span>`;
state.bulkGeneratePeriod = period;
document.getElementById('apply-to-all-days').checked = false;
document.getElementById('modal-bulk-generate').classList.remove('hidden');
}

async function confirmBulkGenerate() {
const period = state.bulkGeneratePeriod;
const applyToAllDays = document.getElementById('apply-to-all-days').checked;
try {
showLoader(true);
let message;
if (applyToAllDays) {
message = "Gerando horários para os próximos 30 dias úteis...";
showToast(message);
await bulkGenerateForMultipleDays(period);
} else {
message = "Gerando horários para o dia selecionado...";
showToast(message);
await generateSlotsForSingleDay(period, currentModalDate);
}
renderAdminDaySlots();
renderAdminCalendar();
showToast("Horários gerados com sucesso!");
} catch (error) {
console.error("Error generating slots:", error);
showToast("Erro ao gerar horários. Tente novamente.", "error");
} finally {
showLoader(false);
}
}

async function bulkGenerateForMultipleDays(period) {
const today = new Date();
const datesToGenerate = [];
let daysChecked = 0;
while (datesToGenerate.length < 30 && daysChecked < 60) {
const nextDate = new Date(today);
nextDate.setDate(today.getDate() + daysChecked + 1);
const dayOfWeek = nextDate.getDay();
if (dayOfWeek !== 0) {
datesToGenerate.push(nextDate.toISOString().split('T')[0]);
}
daysChecked++;
}
for (let i = 0; i < datesToGenerate.length; i++) {
const date = datesToGenerate[i];
await generateSlotsForSingleDay(period, date);
if (i % 5 === 0 || i === datesToGenerate.length - 1) {
showToast(`Progresso: ${i + 1} de ${datesToGenerate.length} dias`);
}
}
}

async function generateSlotsForSingleDay(period, date) {
let newSlots = [];
let daySlots = cache.slots[date] || [];
if (period === 'morning' || period === 'all') {
for (let h = 9; h <= 12; h++) {
const timeStr = `${String(h).padStart(2, '0')}:00`;
if (!daySlots.includes(timeStr) && !newSlots.includes(timeStr)) {
newSlots.push(timeStr);
}
}
}
if (period === 'afternoon' || period === 'all') {
for (let h = 13; h <= 18; h++) {
const timeStr = `${String(h).padStart(2, '0')}:00`;
if (!daySlots.includes(timeStr) && !newSlots.includes(timeStr)) {
newSlots.push(timeStr);
}
}
}
if (period === 'evening' || period === 'all') {
for (let h = 19; h <= 20; h++) {
const timeStr = `${String(h).padStart(2, '0')}:00`;
if (!daySlots.includes(timeStr) && !newSlots.includes(timeStr)) {
newSlots.push(timeStr);
}
}
}
if (newSlots.length === 0) {
return;
}
daySlots = [...daySlots, ...newSlots];
daySlots.sort();
await db.collection('slots').doc(date).set({
times: daySlots,
date: date,
updatedAt: new Date()
});
cache.slots[date] = daySlots;
}

// Settings
async function saveSettings() {
showLoader(true);
const saveButton = document.querySelector('#tab-settings button');
const originalText = saveButton.innerHTML;
saveButton.innerHTML = '<i class="fa-solid fa-spinner animate-spin mr-1"></i> Salvando...';
try {
const barbershopName = document.getElementById('setting-barbershop-name').value.trim();
const address = document.getElementById('setting-address').value.trim();
const services = document.getElementById('setting-services').value.trim();
const confirmMsg = document.getElementById('setting-msg-confirm').value.trim();
const reminderMsg = document.getElementById('setting-msg-reminder').value.trim();
const workingDays = [];
document.querySelectorAll('#tab-settings input[type="checkbox"]').forEach(checkbox => {
if (checkbox.checked) {
workingDays.push(checkbox.id.replace('day-', ''));
}
});
if (!barbershopName) {
showToast("Nome da barbearia é obrigatório.", "error");
return;
}
state.settings = {
...state.settings,
barbershopName,
address,
services,
confirmMsg,
reminderMsg,
workingDays,
updatedAt: new Date()
};
await db.collection('settings').doc('main').set(state.settings, { merge: true });
updateServicePrices();
showToast("Configurações salvas com sucesso!");
} catch (error) {
console.error("Error saving settings:", error);
showToast("Erro ao salvar configurações. Tente novamente.", "error");
} finally {
showLoader(false);
saveButton.innerHTML = originalText;
}
}

// Export/Import
async function exportAllData() {
if (!confirm("Você está prestes a exportar TODOS os dados do sistema. Deseja continuar?")) {
return;
}
showLoader(true);
try {
const exportData = {
timestamp: new Date().toISOString(),
settings: state.settings,
slots: cache.slots,
bookings: cache.bookings,
clients: Object.values(cache.clients),
barbers: Object.values(cache.barbers)
};
const dataStr = JSON.stringify(exportData, null, 2);
const dataUri = 'application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
const exportFileDefaultName = `barbershop_backup_${new Date().toISOString().split('T')[0]}.json`;
const linkElement = document.createElement('a');
linkElement.setAttribute('href', dataUri);
linkElement.setAttribute('download', exportFileDefaultName);
linkElement.click();
showToast("Backup completo exportado com sucesso!");
} catch (error) {
console.error("Error exporting ", error);
showToast("Erro ao exportar dados. Tente novamente.", "error");
} finally {
showLoader(false);
}
}

async function resetApp() {
if (!confirm("ATENÇÃO: Isso apagará TODOS os dados do sistema, incluindo agendamentos, clientes e configurações. Esta ação não pode ser desfeita. Deseja continuar?")) {
return;
}
showLoader(true);
try {
const batch = db.batch();
const collections = ['slots', 'bookings', 'clients', 'barbers'];
for (const collection of collections) {
const snapshot = await db.collection(collection).get();
snapshot.forEach(doc => {
batch.delete(doc.ref);
});
}
const defaultSettings = {
confirmMsg: "Olá {nome}, confirmamos seu agendamento para {data} às {hora} para {servico}. Valor: R$ {valor}. Estamos localizados na Rua das Lâminas, 456. Chegue 10 minutos antes do horário marcado.",
reminderMsg: "Olá {nome}, lembrando do seu agendamento amanhã ({data}) às {hora} para {servico}. Estamos ansiosos para atendê-lo na BarberShop Pro!",
barbershopName: "BarberShop Pro",
address: "Rua das Lâminas, 456 - Centro",
services: "Corte Social, Corte Degradê, Barba Simples, Barba Completa, Corte + Barba, Sobrancelha",
workingDays: ["mon", "tue", "wed", "thu", "fri", "sat"],
createdAt: new Date(),
updatedAt: new Date()
};
batch.set(db.collection('settings').doc('main'), defaultSettings);
await batch.commit();
cache = {
slots: {},
bookings: [],
clients: {},
barbers: {},
lastUpdated: new Date()
};
await Promise.all([
loadSettings(),
loadSlotsCache(),
loadBookingsCache(),
loadClientsCache(),
loadBarbersCache()
]);
if (state.view === 'view-admin') {
renderAdminCalendar();
updateDashboard();
} else {
renderClientDates();
renderClientSlots();
}
showToast("Sistema resetado com sucesso! Todos os dados foram apagados.", "success");
} catch (error) {
console.error("Error resetting app:", error);
showToast("Erro ao resetar o sistema. Tente novamente.", "error");
} finally {
showLoader(false);
}
}

// Financial Report
async function renderFinancial() {
showLoader(true);
const container = document.getElementById('fin-history');
const totalEl = document.getElementById('fin-total');
const sessionsDoneEl = document.getElementById('fin-sessions-done');
const averagePerSessionEl = document.getElementById('fin-average-per-session');
const totalServicesEl = document.getElementById('fin-total-services');
const period = document.getElementById('financial-period').value;
try {
const now = new Date();
let startDate, endDate;
switch (period) {
case 'month':
startDate = new Date(now.getFullYear(), now.getMonth(), 1);
endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
break;
case 'quarter':
const quarterStartMonth = Math.floor(now.getMonth() / 3) * 3;
startDate = new Date(now.getFullYear(), quarterStartMonth, 1);
endDate = new Date(now.getFullYear(), quarterStartMonth + 3, 0);
break;
case 'semester':
const semesterStartMonth = Math.floor(now.getMonth() / 6) * 6;
startDate = new Date(now.getFullYear(), semesterStartMonth, 1);
endDate = new Date(now.getFullYear(), semesterStartMonth + 6, 0);
break;
case 'year':
startDate = new Date(now.getFullYear(), 0, 1);
endDate = new Date(now.getFullYear(), 11, 31);
break;
}
const startISO = startDate.toISOString().split('T')[0];
const endISO = endDate.toISOString().split('T')[0];
const periodBookings = cache.bookings.filter(b =>
b.date >= startISO && b.date <= endISO && b.status === 'confirmed'
);
const totalRevenue = periodBookings.reduce((sum, b) => sum + (b.value || 0), 0);
const sessionsDone = periodBookings.length;
const averagePerSession = sessionsDone > 0 ? totalRevenue / sessionsDone : 0;
totalEl.innerText = totalRevenue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
sessionsDoneEl.innerText = sessionsDone;
averagePerSessionEl.innerText = averagePerSession.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
totalServicesEl.innerText = totalRevenue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
const monthsMap = {};
periodBookings.forEach(booking => {
const monthKey = booking.date.substring(0, 7);
if (!monthsMap[monthKey]) {
monthsMap[monthKey] = {
total: 0,
count: 0
};
}
monthsMap[monthKey].total += booking.value || 35;
monthsMap[monthKey].count += 1;
});
container.innerHTML = '';
if (Object.keys(monthsMap).length === 0) {
container.innerHTML = `
<div class="p-4 text-center text-slate-500">
<i class="fa-regular fa-calendar-xmark text-3xl opacity-50 mb-2 block"></i>
<p>Nenhum agendamento no período selecionado</p>
</div>
`;
return;
}
const sortedMonths = Object.keys(monthsMap).sort().reverse();
sortedMonths.forEach(monthKey => {
const data = monthsMap[monthKey];
const [year, month] = monthKey.split('-');
const monthDate = new Date(parseInt(year), parseInt(month) - 1);
const monthName = monthDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
const row = document.createElement('div');
row.className = "p-4 hover:bg-slate-50 transition border-b border-slate-100 last:border-b-0";
row.innerHTML = `
<div class="flex justify-between items-center mb-2">
<span class="font-bold text-slate-800 capitalize">${monthName}</span>
<span class="font-bold text-slate-800">${data.total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>
</div>
<div class="flex justify-between text-xs text-slate-500">
<span>${data.count} atendimento${data.count !== 1 ? 's' : ''}</span>
<span>Média: ${Math.round(data.total / data.count).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>
</div>
<div class="mt-3 h-2 bg-slate-100 rounded-full overflow-hidden">
<div class="h-full bg-blue-500 rounded-full" style="width: ${Math.min(100, (data.total / (Math.max(...Object.values(monthsMap).map(m => m.total)) || 1)) * 100)}%"></div>
</div>
`;
container.appendChild(row);
});
} catch (error) {
console.error("Error rendering financial data:", error);
container.innerHTML = `
<div class="p-4 text-center text-red-500">
<i class="fa-solid fa-triangle-exclamation text-2xl mb-2 block"></i>
<p>Erro ao carregar dados financeiros</p>
</div>
`;
} finally {
showLoader(false);
}
}

// Client Functions
async function renderClients() {
const search = document.getElementById('client-search').value.toLowerCase();
const list = document.getElementById('clients-list');
list.innerHTML = '<div class="flex justify-center items-center py-10"><div class="text-center"><div class="loader mx-auto mb-3"></div><p class="text-slate-500">Carregando clientes...</p></div></div>';
try {
let clients = Object.values(cache.clients);
if (search) {
clients = clients.filter(client =>
client.name.toLowerCase().includes(search) ||
client.phone.toLowerCase().includes(search.replace(/\D/g, '')) ||
(client.email && client.email.toLowerCase().includes(search))
);
}
clients.sort((a, b) => {
if (!a.lastVisit) return 1;
if (!b.lastVisit) return -1;
return new Date(b.lastVisit) - new Date(a.lastVisit);
});
document.getElementById('clients-count').innerText = clients.length;
const loadMoreBtn = document.getElementById('load-more-clients');
loadMoreBtn.classList.add('hidden');
if (clients.length === 0) {
list.innerHTML = `
<div class="empty-state py-10">
<i class="fa-solid fa-magnifying-glass text-slate-300"></i>
<h4 class="font-bold text-lg text-slate-700">Nenhum cliente encontrado</h4>
<p class="text-slate-500">Tente outra busca ou cadastre um novo cliente</p>
<button onclick="openNewClientModal()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition">
<i class="fa-solid fa-user-plus mr-1"></i> Cadastrar Novo Cliente
</button>
</div>
`;
return;
}
list.innerHTML = '';
clients.slice(0, clientsPerPage).forEach(client => {
const lastVisitDate = client.lastVisit ? new Date(client.lastVisit + 'T00:00:00') : null;
const formattedDate = lastVisitDate ? lastVisitDate.toLocaleDateString('pt-BR') : 'Nenhuma visita';
const totalVisits = client.totalVisits || 0;
const el = document.createElement('div');
el.className = "bg-white p-4 rounded-xl shadow-sm border border-slate-100";
el.innerHTML = `
<div class="flex justify-between items-start">
<div class="min-w-0 flex-1">
<div class="flex items-start">
<div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center mr-3 flex-shrink-0">
<span class="text-white text-lg font-bold">${client.name.charAt(0)}</span>
</div>
<div class="min-w-0 flex-1">
<h4 class="font-bold text-lg text-slate-800 truncate" title="${client.name}">${client.name}</h4>
<div class="flex flex-wrap items-center gap-2 mt-1">
<span class="text-sm text-slate-600 flex items-center">
<i class="fa-solid fa-phone mr-1 text-slate-400"></i> ${client.phone}
</span>
${client.email ? `
<span class="text-sm text-slate-600 flex items-center">
<i class="fa-solid fa-envelope mr-1 text-slate-400"></i> ${client.email}
</span>` : ''}
</div>
<div class="flex flex-wrap items-center gap-2 mt-2 text-sm">
<span class="text-slate-500 flex items-center">
<i class="fa-solid fa-calendar-day mr-1 text-slate-400"></i> Última visita: ${formattedDate}
</span>
<span class="text-slate-500 flex items-center">
<i class="fa-solid fa-scissors mr-1 text-slate-400"></i> ${totalVisits} visita${totalVisits !== 1 ? 's' : ''}
</span>
${client.preferredBarber ? `
<span class="text-slate-500 flex items-center">
<i class="fa-solid fa-user-tie mr-1 text-slate-400"></i> Barbeiro: ${client.preferredBarber}
</span>` : ''}
</div>
</div>
<a href="https://wa.me/55${client.phone.replace(/\D/g,'')}" target="_blank" class="w-8 h-8 bg-green-50 text-green-600 rounded-lg flex items-center justify-center hover:bg-green-100 transition" title="WhatsApp">
<i class="fa-brands fa-whatsapp text-sm"></i>
</a>
`;
container.appendChild(clientEl);
});
}

// Financial Functions
async function renderFinancial() {
showLoader(true);
const container = document.getElementById('fin-history');
const totalEl = document.getElementById('fin-total');
const sessionsDoneEl = document.getElementById('fin-sessions-done');
const averagePerSessionEl = document.getElementById('fin-average-per-session');
const totalServicesEl = document.getElementById('fin-total-services');
const period = document.getElementById('financial-period').value;
try {
const now = new Date();
let startDate, endDate;
switch (period) {
case 'month':
startDate = new Date(now.getFullYear(), now.getMonth(), 1);
endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
break;
case 'quarter':
const quarterStartMonth = Math.floor(now.getMonth() / 3) * 3;
startDate = new Date(now.getFullYear(), quarterStartMonth, 1);
endDate = new Date(now.getFullYear(), quarterStartMonth + 3, 0);
break;
case 'semester':
const semesterStartMonth = Math.floor(now.getMonth() / 6) * 6;
startDate = new Date(now.getFullYear(), semesterStartMonth, 1);
endDate = new Date(now.getFullYear(), semesterStartMonth + 6, 0);
break;
case 'year':
startDate = new Date(now.getFullYear(), 0, 1);
endDate = new Date(now.getFullYear(), 11, 31);
break;
}
const startISO = startDate.toISOString().split('T')[0];
const endISO = endDate.toISOString().split('T')[0];
const periodBookings = cache.bookings.filter(b =>
b.date >= startISO && b.date <= endISO && b.status === 'confirmed'
);
const totalRevenue = periodBookings.reduce((sum, b) => sum + (b.value || 0), 0);
const sessionsDone = periodBookings.length;
const averagePerSession = sessionsDone > 0 ? totalRevenue / sessionsDone : 0;
totalEl.innerText = totalRevenue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
sessionsDoneEl.innerText = sessionsDone;
averagePerSessionEl.innerText = averagePerSession.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
totalServicesEl.innerText = totalRevenue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
const monthsMap = {};
periodBookings.forEach(booking => {
const monthKey = booking.date.substring(0, 7);
if (!monthsMap[monthKey]) {
monthsMap[monthKey] = {
total: 0,
count: 0
};
}
monthsMap[monthKey].total += booking.value || 35;
monthsMap[monthKey].count += 1;
});
container.innerHTML = '';
if (Object.keys(monthsMap).length === 0) {
container.innerHTML = `
<div class="p-4 text-center text-slate-500">
<i class="fa-regular fa-calendar-xmark text-3xl opacity-50 mb-2 block"></i>
<p>Nenhum agendamento no período selecionado</p>
</div>
`;
return;
}
const sortedMonths = Object.keys(monthsMap).sort().reverse();
sortedMonths.forEach(monthKey => {
const data = monthsMap[monthKey];
const [year, month] = monthKey.split('-');
const monthDate = new Date(parseInt(year), parseInt(month) - 1);
const monthName = monthDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
const row = document.createElement('div');
row.className = "p-4 hover:bg-slate-50 transition border-b border-slate-100 last:border-b-0";
row.innerHTML = `
<div class="flex justify-between items-center mb-2">
<span class="font-bold text-slate-800 capitalize">${monthName}</span>
<span class="font-bold text-slate-800">${data.total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>
</div>
<div class="flex justify-between text-xs text-slate-500">
<span>${data.count} atendimento${data.count !== 1 ? 's' : ''}</span>
<span>Média: ${Math.round(data.total / data.count).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>
</div>
<div class="mt-3 h-2 bg-slate-100 rounded-full overflow-hidden">
<div class="h-full bg-blue-500 rounded-full" style="width: ${Math.min(100, (data.total / (Math.max(...Object.values(monthsMap).map(m => m.total)) || 1)) * 100)}%"></div>
</div>
`;
container.appendChild(row);
});
} catch (error) {
console.error("Error rendering financial data:", error);
container.innerHTML = `
<div class="p-4 text-center text-red-500">
<i class="fa-solid fa-triangle-exclamation text-2xl mb-2 block"></i>
<p>Erro ao carregar dados financeiros</p>
</div>
`;
} finally {
showLoader(false);
}
}

// Reminder Functions
let currentReminderBookingId = null;
function openReminderModal(bookingId, clientName) {
currentReminderBookingId = bookingId;
document.getElementById('reminder-text').innerText = `Você está prestes a enviar um lembrete para ${clientName} sobre seu atendimento.`;
document.getElementById('modal-reminder').classList.remove('hidden');
}

async function sendReminderManually() {
if (!currentReminderBookingId) return;
try {
showLoader(true);
closeModal('modal-reminder');
const booking = cache.bookings.find(b => b.id === currentReminderBookingId);
if (!booking) {
throw new Error("Agendamento não encontrado");
}
const client = cache.clients[booking.clientPhone] || { name: booking.clientName };
const clientFirstName = client.name.split(' ')[0];
const formattedDate = booking.date.split('-').reverse().join('/');
let message = (state.settings?.reminderMsg || "Olá {nome}, lembrando do seu agendamento amanhã ({data}) às {hora} para {servico}.")
.replace('{nome}', clientFirstName)
.replace('{data}', formattedDate)
.replace('{hora}', booking.time)
.replace('{servico}', booking.service);
const whatsappUrl = `https://wa.me/55${booking.clientPhone.replace(/\D/g, '')}?text=${encodeURIComponent(message)}`;
window.open(whatsappUrl, '_blank');
await db.collection('bookings').doc(booking.id).update({
reminderSent: true,
reminderSentAt: new Date()
});
const bookingIndex = cache.bookings.findIndex(b => b.id === booking.id);
if (bookingIndex !== -1) {
cache.bookings[bookingIndex].reminderSent = true;
cache.bookings[bookingIndex].reminderSentAt = new Date();
}
showToast("Lembrete enviado com sucesso!");
} catch (error) {
console.error("Error sending reminder:", error);
showToast("Erro ao enviar lembrete. Tente novamente.", "error");
} finally {
showLoader(false);
currentReminderBookingId = null;
}
}

// Export Functions
async function exportClientsToCSV() {
showLoader(true);
try {
const clients = Object.values(cache.clients);
if (clients.length === 0) {
showToast("Nenhum cliente para exportar.", "error");
return;
}
const headers = [
'Nome',
'Telefone',
'Email',
'Barbeiro Preferencial',
'Histórico de Serviços',
'Origem',
'Data de Cadastro',
'Última Visita',
'Total de Visitas'
];
const rows = clients.map(client => [
client.name || '',
client.phone || '',
client.email || '',
client.preferredBarber || '',
(client.serviceHistory || []).join(', ') || '',
client.source || '',
new Date(client.createdAt?.toDate() || client.createdAt || new Date()).toLocaleDateString('pt-BR'),
client.lastVisit ? new Date(client.lastVisit + 'T00:00:00').toLocaleDateString('pt-BR') : '',
client.totalVisits || 0
]);
let csvContent = "text/csv;charset=utf-8,";
csvContent += headers.join(';') + '\n';
rows.forEach(row => {
csvContent += row.map(field => 
typeof field === 'string' ? `"${field.replace(/"/g, '""')}"` : field
).join(';') + '\n';
});
const encodedUri = encodeURI(csvContent);
const link = document.createElement("a");
link.setAttribute("href", encodedUri);
link.setAttribute("download", `clientes_barbershop_${new Date().toISOString().split('T')[0]}.csv`);
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
showToast("Clientes exportados com sucesso!");
} catch (error) {
console.error("Error exporting clients:", error);
showToast("Erro ao exportar clientes. Tente novamente.", "error");
} finally {
showLoader(false);
}
}

// Modal Functions
function openReminderModal(bookingId, clientName) {
currentReminderBookingId = bookingId;
document.getElementById('reminder-text').innerText = `Você está prestes a enviar um lembrete para ${clientName} sobre seu atendimento.`;
document.getElementById('modal-reminder').classList.remove('hidden');
}

function closeAllModals() {
document.querySelectorAll('.modal-overlay').forEach(modal => {
modal.classList.add('hidden');
});
}

// Event Listeners
document.addEventListener('DOMContentLoaded', () => {
// Close modals when clicking outside
document.querySelectorAll('.modal-overlay').forEach(overlay => {
overlay.addEventListener('click', (e) => {
if (e.target === overlay) {
overlay.classList.add('hidden');
}
});
});
// Handle touch events for mobile
let touchStartX = 0;
document.addEventListener('touchstart', (e) => {
touchStartX = e.touches[0].clientX;
});
document.addEventListener('touchend', (e) => {
const touchEndX = e.changedTouches[0].clientX;
const diff = touchStartX - touchEndX;
if (Math.abs(diff) > 50) {
if (diff > 0) {
// Swipe left
if (state.view === 'view-profile' && document.getElementById('view-client-calendar').classList.contains('active')) {
navigateTo('view-profile');
}
} else {
// Swipe right
if (state.view === 'view-profile' && !document.getElementById('view-client-calendar').classList.contains('active')) {
navigateTo('view-client-calendar');
}
}
}
});
});

// Initialize the app
console.log("BarberShop Pro initialized successfully!");
</script>
</body>
</html>

